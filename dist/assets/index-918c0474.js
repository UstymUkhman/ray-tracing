(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();let Q=tt;const v=1,b=2,Z={owned:null,cleanups:null,context:null,owner:null};var p=null;let D=null,g=null,d=null,m=null,C=0;function at(s,t){const e=g,n=p,i=s.length===0,r=i?Z:{owned:null,cleanups:null,context:null,owner:t===void 0?n:t},a=i?s:()=>s(()=>x(()=>I(r)));p=r,g=null;try{return M(a,!0)}finally{g=e,p=n}}function P(s,t,e){const n=J(s,t,!1,v);N(n)}function ct(s,t,e){Q=dt;const n=J(s,t,!1,v);(!e||!e.render)&&(n.user=!0),m?m.push(n):N(n)}function x(s){if(g===null)return s();const t=g;g=null;try{return s()}finally{g=t}}function lt(s){ct(()=>x(s))}function ht(s,t,e){let n=s.value;return(!s.comparator||!s.comparator(n,t))&&(s.value=t,s.observers&&s.observers.length&&M(()=>{for(let i=0;i<s.observers.length;i+=1){const r=s.observers[i],a=D&&D.running;a&&D.disposed.has(r),(a?!r.tState:!r.state)&&(r.pure?d.push(r):m.push(r),r.observers&&et(r)),a||(r.state=v)}if(d.length>1e6)throw d=[],new Error},!1)),t}function N(s){if(!s.fn)return;I(s);const t=p,e=g,n=C;g=p=s,ft(s,s.value,n),g=e,p=t}function ft(s,t,e){let n;try{n=s.fn(t)}catch(i){return s.pure&&(s.state=v,s.owned&&s.owned.forEach(I),s.owned=null),s.updatedAt=e+1,st(i)}(!s.updatedAt||s.updatedAt<=e)&&(s.updatedAt!=null&&"observers"in s?ht(s,n):s.value=n,s.updatedAt=e)}function J(s,t,e,n=v,i){const r={fn:s,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:p,context:null,pure:e};return p===null||p!==Z&&(p.owned?p.owned.push(r):p.owned=[r]),r}function A(s){if(s.state===0)return;if(s.state===b)return O(s);if(s.suspense&&x(s.suspense.inFallback))return s.suspense.effects.push(s);const t=[s];for(;(s=s.owner)&&(!s.updatedAt||s.updatedAt<C);)s.state&&t.push(s);for(let e=t.length-1;e>=0;e--)if(s=t[e],s.state===v)N(s);else if(s.state===b){const n=d;d=null,M(()=>O(s,t[0]),!1),d=n}}function M(s,t){if(d)return s();let e=!1;t||(d=[]),m?e=!0:m=[],C++;try{const n=s();return ut(e),n}catch(n){e||(m=null),d=null,st(n)}}function ut(s){if(d&&(tt(d),d=null),s)return;const t=m;m=null,t.length&&M(()=>Q(t),!1)}function tt(s){for(let t=0;t<s.length;t++)A(s[t])}function dt(s){let t,e=0;for(t=0;t<s.length;t++){const n=s[t];n.user?s[e++]=n:A(n)}for(t=0;t<e;t++)A(s[t])}function O(s,t){s.state=0;for(let e=0;e<s.sources.length;e+=1){const n=s.sources[e];if(n.sources){const i=n.state;i===v?n!==t&&(!n.updatedAt||n.updatedAt<C)&&A(n):i===b&&O(n,t)}}}function et(s){for(let t=0;t<s.observers.length;t+=1){const e=s.observers[t];e.state||(e.state=b,e.pure?d.push(e):m.push(e),e.observers&&et(e))}}function I(s){let t;if(s.sources)for(;s.sources.length;){const e=s.sources.pop(),n=s.sourceSlots.pop(),i=e.observers;if(i&&i.length){const r=i.pop(),a=e.observerSlots.pop();n<i.length&&(r.sourceSlots[a]=n,i[n]=r,e.observerSlots[n]=a)}}if(s.owned){for(t=s.owned.length-1;t>=0;t--)I(s.owned[t]);s.owned=null}if(s.cleanups){for(t=s.cleanups.length-1;t>=0;t--)s.cleanups[t]();s.cleanups=null}s.state=0,s.context=null}function st(s){throw s}function pt(s,t){return x(()=>s(t||{}))}function gt(s,t,e){let n=e.length,i=t.length,r=n,a=0,o=0,l=t[i-1].nextSibling,h=null;for(;a<i||o<r;){if(t[a]===e[o]){a++,o++;continue}for(;t[i-1]===e[r-1];)i--,r--;if(i===a){const c=r<n?o?e[o-1].nextSibling:e[r-o]:l;for(;o<r;)s.insertBefore(e[o++],c)}else if(r===o)for(;a<i;)(!h||!h.has(t[a]))&&t[a].remove(),a++;else if(t[a]===e[r-1]&&e[o]===t[i-1]){const c=t[--i].nextSibling;s.insertBefore(e[o++],t[a++].nextSibling),s.insertBefore(e[--r],c),t[i]=e[r]}else{if(!h){h=new Map;let f=o;for(;f<r;)h.set(e[f],f++)}const c=h.get(t[a]);if(c!=null)if(o<c&&c<r){let f=a,L=1,W;for(;++f<i&&f<r&&!((W=h.get(t[f]))==null||W!==c+L);)L++;if(L>c-o){const ot=t[a];for(;o<c;)s.insertBefore(e[o++],ot)}else s.replaceChild(e[o++],t[a++])}else a++;else t[a++].remove()}}}function mt(s,t,e,n={}){let i;return at(r=>{i=r,t===document?s():wt(t,s(),t.firstChild?null:void 0,e)},n.owner),()=>{i(),t.textContent=""}}function vt(s,t,e){let n;const i=()=>{const a=document.createElement("template");return a.innerHTML=s,e?a.content.firstChild.firstChild:a.content.firstChild},r=t?()=>(n||(n=i())).cloneNode(!0):()=>x(()=>document.importNode(n||(n=i()),!0));return r.cloneNode=r,r}function E(s,t,e){e==null?s.removeAttribute(t):s.setAttribute(t,e)}function V(s,t,e){return x(()=>s(t,e))}function wt(s,t,e,n){if(e!==void 0&&!n&&(n=[]),typeof t!="function")return _(s,t,n,e);P(i=>_(s,t(),i,e),n)}function _(s,t,e,n,i){for(;typeof e=="function";)e=e();if(t===e)return e;const r=typeof t,a=n!==void 0;if(s=a&&e[0]&&e[0].parentNode||s,r==="string"||r==="number")if(r==="number"&&(t=t.toString()),a){let o=e[0];o&&o.nodeType===3?o.data=t:o=document.createTextNode(t),e=w(s,e,n,o)}else e!==""&&typeof e=="string"?e=s.firstChild.data=t:e=s.textContent=t;else if(t==null||r==="boolean")e=w(s,e,n);else{if(r==="function")return P(()=>{let o=t();for(;typeof o=="function";)o=o();e=_(s,o,e,n)}),()=>e;if(Array.isArray(t)){const o=[],l=e&&Array.isArray(e);if(F(o,t,e,i))return P(()=>e=_(s,o,e,n,!0)),()=>e;if(o.length===0){if(e=w(s,e,n),a)return e}else l?e.length===0?q(s,o,n):gt(s,e,o):(e&&w(s),q(s,o));e=o}else if(t.nodeType){if(Array.isArray(e)){if(a)return e=w(s,e,n,t);w(s,e,null,t)}else e==null||e===""||!s.firstChild?s.appendChild(t):s.replaceChild(t,s.firstChild);e=t}else console.warn("Unrecognized value. Skipped inserting",t)}return e}function F(s,t,e,n){let i=!1;for(let r=0,a=t.length;r<a;r++){let o=t[r],l=e&&e[r],h;if(!(o==null||o===!0||o===!1))if((h=typeof o)=="object"&&o.nodeType)s.push(o);else if(Array.isArray(o))i=F(s,o,l)||i;else if(h==="function")if(n){for(;typeof o=="function";)o=o();i=F(s,Array.isArray(o)?o:[o],Array.isArray(l)?l:[l])||i}else s.push(o),i=!0;else{const c=String(o);l&&l.nodeType===3&&l.data===c?s.push(l):s.push(document.createTextNode(c))}}return i}function q(s,t,e=null){for(let n=0,i=t.length;n<i;n++)s.insertBefore(t[n],e)}function w(s,t,e,n){if(e===void 0)return s.textContent="";const i=n||document.createTextNode("");if(t.length){let r=!1;for(let a=t.length-1;a>=0;a--){const o=t[a];if(i!==o){const l=o.parentNode===s;!r&&!a?l?s.replaceChild(i,o):s.insertBefore(i,e):l&&o.remove()}else r=!0}}else s.insertBefore(i,e);return[i]}function xt(){return new Worker(""+new URL("worker-e0388645.js",import.meta.url).href,{type:"module"})}class Et{worker=new xt;events=new Map;constructor(){this.worker.onmessage=this.onMessage.bind(this),this.worker.onerror=this.onError.bind(this)}add(t,e,n){this.events.set(t,{callback:e,params:n})}transfer(t,e){this.worker.postMessage({event:"Transfer::Offscreen",params:{canvas:t,...e}},[t])}post(t,e){const n=this.events.get(t)?.params;this.worker.postMessage({event:t,params:{...n,...e}})}onMessage(t){const{name:e,response:n}=t.data;this.events?.get(e)?.callback?.(n)}onError(t){console.error(t)}remove(t){this.events.delete(t)}dispose(){this.events.clear()}}const u={backEnd:"webgl2",pixelRatio:1,maxDepth:50,samples:500,height:240,width:360,log:!1};class yt{downloadImage(t,e="image"){const n=document.createElement("a");n.href=URL.createObjectURL(new Blob([t],{type:"text/plain; charset=UTF-8"})),n.download=`${e}.ppm`,n.click(),URL.revokeObjectURL(n.href)}}const Tt="modulepreload",bt=function(s,t){return new URL(s,t).href},X={},R=function(t,e,n){if(!e||e.length===0)return t();const i=document.getElementsByTagName("link");return Promise.all(e.map(r=>{if(r=bt(r,n),r in X)return;X[r]=!0;const a=r.endsWith(".css"),o=a?'[rel="stylesheet"]':"";if(!!n)for(let c=i.length-1;c>=0;c--){const f=i[c];if(f.href===r&&(!a||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${o}`))return;const h=document.createElement("link");if(h.rel=a?"stylesheet":Tt,a||(h.as="script",h.crossOrigin=""),h.href=r,document.head.appendChild(h),a)return new Promise((c,f)=>{h.addEventListener("load",c),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>t())},$=(s,t=0,e=1)=>Math.max(t,Math.min(s,e)),k=(s,t)=>Math.random()*(t-s)+s,Wt=s=>s*Math.PI/180,S=(s,t=2)=>{const e=Math.pow(10,t);return~~(e*s)/e},Pt=1/.06,At=`#version 300 es

precision mediump float;

uniform vec2 resolution;

in  vec2 position;
in  vec2 coords;
out vec2 uv;

void main (void)
{
  gl_Position = vec4((
    position / resolution * 2.0 - 1.0
  ) * vec2(1.0, -1.0), 0.0, 1.0);

  uv = coords;
}
`,_t=`#version 300 es

#ifndef GL_FRAGMENT_PRECISION_HIGH
  precision mediump float;
#else
  precision highp float;
#endif

uniform sampler2D tex;

in  vec2 uv;
out vec4 fragColor;

void main (void)
{
  fragColor = texture(tex, uv);
}
`;class G{vec=[0,0,0];constructor(t=0,e=t,n=t){this.vec[0]=t,this.vec[1]=e,this.vec[2]=n}refract(t,e){const n=Math.min(this.clone.negate.dot(t),1);this.copy(t.clone.multiply(n).add(this).multiply(e));const i=Math.abs(1-this.lengthSquared);return this.add(t.multiply(-Math.sqrt(i)))}set(t,e,n){return this.vec[0]=t,this.vec[1]=e,this.vec[2]=n,this}multiply(t){if(typeof t!="number")return this.set(this.vec[0]*t.x,this.vec[1]*t.y,this.vec[2]*t.z);const e=t;return this.vec[0]*=e,this.vec[1]*=e,this.vec[2]*=e,this}divide(t){return typeof t=="number"?this.multiply(1/t):this.set(this.vec[0]/t.x,this.vec[1]/t.y,this.vec[2]/t.z)}random(t=0,e=1){return this.set(k(t,e),k(t,e),k(t,e))}reflect(t){return this.sub(t.clone.multiply(this.dot(t)*2))}get randomUnitVector(){return this.randomUnitSphere.unitVector}get randomUnitSphere(){for(;;)if(this.random(-1).lengthSquared<1)return this}get lengthSquared(){return this.dot(this)}get randomUnitDisk(){for(;;)if(this.random(-1),this.vec[2]=0,this.lengthSquared<1)return this}cross(t){return this.set(this.vec[1]*t.z-this.vec[2]*t.y,this.vec[2]*t.x-this.vec[0]*t.z,this.vec[0]*t.y-this.vec[1]*t.x)}dot(t){return this.vec[0]*t.x+this.vec[1]*t.y+this.vec[2]*t.z}copy(t){const{x:e,y:n,z:i}=t;return this.set(e,n,i)}add(t){return this.vec[0]+=t.x,this.vec[1]+=t.y,this.vec[2]+=t.z,this}sub(t){return this.vec[0]-=t.x,this.vec[1]-=t.y,this.vec[2]-=t.z,this}get nearZero(){return Math.abs(this.vec[0])<1e-8&&Math.abs(this.vec[1])<1e-8&&Math.abs(this.vec[2])<1e-8}get unitVector(){return this.divide(this.length)}get length(){return Math.sqrt(this.lengthSquared)}get clone(){return new G(this.vec[0],this.vec[1],this.vec[2])}reset(t=0){return this.set(t,t,t)}get negate(){return this.multiply(-1)}get sqrt(){return this.set(Math.sqrt(this.vec[0]),Math.sqrt(this.vec[1]),Math.sqrt(this.vec[2]))}get rgb(){return this.set($(this.vec[0]*256|0,0,255),$(this.vec[1]*256|0,0,255),$(this.vec[2]*256|0,0,255))}get x(){return this.vec[0]}get y(){return this.vec[1]}get z(){return this.vec[2]}}const Rt=(s,t=1)=>new Map([["r",s>>16&t],["g",s>>8&t],["b",s&t]]),St=(s,t)=>s.divide(t).sqrt.rgb,Ct=s=>`#${`000000${s.toString(16)}`.slice(-6)}`,Vt=(s,t,e)=>{const n=new G;for(let i=0;i<t.length;i+=3){const{x:r,y:a,z:o}=St(n.set(t[i],t[i+1],t[i+2]),e);s[i]=r,s[i+1]=a,s[i+2]=o}return s};class nt{context;backEnd;clearColor=0;channels;height;width;side;constructor(t,e){this.backEnd=e;const n=e==="2d",{canvas:i,offscreen:r}=t;this.context=i.getContext(e,this.getOptions(e,r)),this.width=i.width,this.height=i.height,this.channels=+n+3,this.side=this.width*this.channels}getOptions(t,e=!1){switch(t){case"2d":return{willReadFrequently:!e,desynchronized:e,colorSpace:"srgb",alpha:!1};case"webgpu":return{};default:return{powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!1,desynchronized:!e,premultipliedAlpha:!1,antialias:!0,stencil:!1,depth:!1,alpha:!1}}}getPixel(t,e){return e*this.side+t*this.channels}}const Mt=`precision mediump float;

uniform vec2 resolution;

attribute vec2 position;
attribute vec2 coords;
varying   vec2 uv;

void main (void)
{
  gl_Position = vec4((
    position / resolution * 2.0 - 1.0
  ) * vec2(1.0, -1.0), 0.0, 1.0);

  uv = coords;
}
`,It=`#ifndef GL_FRAGMENT_PRECISION_HIGH
  precision mediump float;
#else
  precision highp float;
#endif

uniform sampler2D tex;

varying vec2 uv;

void main (void)
{
  gl_FragColor = texture2D(tex, uv);
}
`;class it extends nt{textureData=new Uint8ClampedArray(this.width*this.height*this.channels);texture;program;constructor(t,e="webgl",n=It,i=Mt){super(t,e),this.createProgram(n,i),this.createScene()}loadShader(t,e){const n=this.context.createShader(e);return this.context.shaderSource(n,t),this.context.compileShader(n),this.context.getShaderParameter(n,this.context.COMPILE_STATUS)?n:(console.error(`An error occurred compiling the shaders: ${this.context.getShaderInfoLog(n)}`),this.context.deleteShader(n))}setBufferData(t=this.width,e=this.height){this.context.bufferData(this.context.ARRAY_BUFFER,new Float32Array([0,0,t,0,0,e,0,e,t,0,t,e]),this.context.STATIC_DRAW)}createProgram(t,e){const n=this.loadShader(t,this.context.FRAGMENT_SHADER),i=this.loadShader(e,this.context.VERTEX_SHADER);if(this.program=this.context.createProgram(),i&&n&&(this.context.attachShader(this.program,n),this.context.attachShader(this.program,i),this.context.linkProgram(this.program)),!this.context.getProgramParameter(this.program,this.context.LINK_STATUS))return console.error(`Unable to initialize shader program: ${this.context.getProgramInfoLog(this.program)}`);this.context.clear(this.context.COLOR_BUFFER_BIT);const r=Rt(this.clearColor,1),a=r.get("r")??0,o=r.get("g")??0,l=r.get("b")??0;this.context.clearColor(a,o,l,1),this.context.useProgram(this.program)}updateTexture(){this.context.activeTexture(this.context.TEXTURE0),this.context.bindTexture(this.context.TEXTURE_2D,this.texture),this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGB,this.width,this.height,0,this.context.RGB,this.context.UNSIGNED_BYTE,this.textureData)}createScene(){const t=this.context.getAttribLocation(this.program,"coords");this.context.bindBuffer(this.context.ARRAY_BUFFER,this.context.createBuffer()),this.setBufferData(1,1),this.context.enableVertexAttribArray(t),this.context.vertexAttribPointer(t,2,this.context.FLOAT,!1,0,0);const e=this.context.getAttribLocation(this.program,"position");this.context.bindBuffer(this.context.ARRAY_BUFFER,this.context.createBuffer()),this.setBufferData(),this.context.enableVertexAttribArray(e),this.context.vertexAttribPointer(e,2,this.context.FLOAT,!1,0,0);const n=this.context.getUniformLocation(this.program,"resolution");this.context.uniform2f(n,this.width,this.height),this.texture=this.context.createTexture(),this.setBufferData(),this.updateTexture(),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.NEAREST),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MAG_FILTER,this.context.NEAREST)}drawImage(t){this.textureData=t,this.updateTexture(),this.context.drawArrays(this.context.TRIANGLES,0,6)}clear(){this.context.clear(this.context.COLOR_BUFFER_BIT)}}class Lt extends it{constructor(t){super(t,"webgl2",_t,At)}}class Dt extends nt{image;constructor(t){super(t,"2d"),this.context.imageSmoothingEnabled=!0,this.context.imageSmoothingQuality="high",this.image=this.context.getImageData(0,0,this.width,this.height)}drawImage(t){for(let e=0,n=0;e<t.length;e+=3,n+=4)this.image.data[n]=t[e],this.image.data[n+1]=t[e+1],this.image.data[n+2]=t[e+2],this.image.data[n+3]=255;this.context.putImageData(this.image,0,0)}clear(){this.context.fillStyle=Ct(this.clearColor),this.context.clearRect(0,0,this.width,this.height),this.context.fillRect(0,0,this.width,this.height)}}class rt{sample=0;trace;format;last=Date.now();f32=new Float32Array(u.width*u.height*3);u8=new Uint8ClampedArray(u.width*u.height*3);canvas;worker;start=Date.now();samples=u.samples;constructor(t){const e=this.getTracer(t);this.canvas=this.createCanvas(t),(this.worker=t.worker)?this.createWorkerEvents(e):this.loadTracer(e),this.canvas.clear()}getTracer(t){return t.tracer!=="assemblyscript"?"typescript":"assemblyscript"}createCanvas(t){switch(t.backEnd){case"webgl2":return new Lt(t);case"webgl":return new it(t);default:return new Dt(t)}}createWorkerEvents(t){this.worker?.post("Create::Tracer",{tracer:t}),this.worker?.add("Create::Tracer",()=>{this.worker?.add("Create::PPMImage",this.showPPMImage.bind(this)),this.createPPMImage()})}loadTracer(t){(t==="assemblyscript"?R(()=>import("./release-e7839f81.js"),[],import.meta.url):R(()=>import("./Tracer-72fb55e8.js"),[],import.meta.url)).then(({trace:e,format:n})=>{this.trace=e,this.format=n,this.createPPMImage()})}createPPMImage(t=!1){if(this.worker)return this.worker.post("Create::PPMImage",{download:t});this.f32=this.trace(this.f32),this.u8=this.format(this.u8,this.f32,++this.sample),this.showPPMImage({pixels:this.u8,sample:this.sample,download:t},!0);const e=Date.now(),i=`${this.samples===this.sample&&"Total "||""}Samples: ${this.sample}`,r=`Total Time: ${S((e-this.start)/1e3)} sec.`,a=`Last Render Time: ${S((e-this.last)/1e3)} sec.`;console.info(`${i} | ${a} | ${r}`),this.last=e}showPPMImage(t,e){const n=t;this.canvas.drawImage(n.pixels),this.samples===n.sample||!(this.worker?n.sample:this.sample)?n.download&&this.downloadPPMImage(n.pixels,e):setTimeout(this.createPPMImage.bind(this,n.download),Pt)}downloadPPMImage(t,e){let n=`P3
${this.canvas.width} ${this.canvas.height}
255
`;for(let i=0;i<t.length;i+=3)n+=`${t[i]} ${t[i+1]} ${t[i+2]}
`;T.dispatch("Download::PPMImage",{image:n},e)}}let z=0,y=0,H,j,Y=Date.now();const $t=u.samples;let U=new Float32Array(u.width*u.height*3),B=new Uint8ClampedArray(u.width*u.height*3);self.onerror=s=>console.error(s);self.onmessage=async s=>{const{event:t}=s.data;let{params:e}=s.data;switch(t){case"Transfer::Offscreen":return new rt({offscreen:!0,...e});case"Create::Tracer":{const n=await(e.tracer==="assemblyscript"?R(()=>import("./release-e7839f81.js"),[],import.meta.url):R(()=>import("./Tracer-72fb55e8.js"),[],import.meta.url));j=n.format,H=n.trace;break}case"Create::PPMImage":{z||=Date.now(),U=H(U),B=j(B,U,++y),e={sample:y,pixels:B,...e};const n=Date.now(),r=`${$t===y&&"Total "||""}Samples: ${y}`,a=`Total Time: ${S((n-z)/1e3)} sec.`,o=`Last Render Time: ${S((n-Y)/1e3)} sec.`;console.info(`${r} | ${o} | ${a}`),Y=n;break}}self.postMessage({response:e,name:t})};const kt=self;class Ut extends CustomEvent{data}class Bt{target=new EventTarget;events=new Map;callbacks=new Map;add(t,e){const n=this.callbacks.get(t);n?n.push(e):this.callbacks.set(t,[e]),this.events.set(t,new Ut(t)),this.target.addEventListener(t,e,!1)}dispatch(t,e){const n=this.events.get(t);n&&(n.data=e,this.target.dispatchEvent(n))}remove(t,e){const n=this.callbacks.get(t);if(n&&e){const i=n.indexOf(e),r=e;i!==-1&&n.splice(i,1),this.target.removeEventListener(t,r,!1)}e||(n?.forEach(i=>this.target.removeEventListener(t,i,!1)),this.callbacks.delete(t),this.events.delete(t))}dispose(){this.callbacks.clear(),this.events.clear()}}class K{constructor(t){this.worker=t}add(t,e){this.worker.add(t,e)}static dispatch(t,e){kt.postMessage({name:t,response:{data:e}})}remove(t){this.worker.remove(t)}dispose(){this.worker.dispose()}}class Ot extends Bt{offscreen=!1;workerEvents;createWorkerEvents(t,e){this.workerEvents=new K(t),this.offscreen=e}add(t,e){this.offscreen?this.workerEvents?.add(t,e):super.add(t,e)}dispatch(t,e,n=!1){n?K.dispatch(t,e):super.dispatch(t,e)}remove(t,e){this.offscreen?this.workerEvents?.remove(t):super.remove(t,e)}dispose(){this.workerEvents?.dispose(),super.dispose()}}const T=new Ot;class Ft{client=new yt;offscreen=typeof HTMLCanvasElement<"u"&&!!HTMLCanvasElement.prototype.transferControlToOffscreen;constructor(t){t.forEach(e=>{const n=new Et,{tracer:i}=e.dataset;T.createWorkerEvents(n,this.offscreen);const{backEnd:r,pixelRatio:a=devicePixelRatio}=u;this.offscreen&&T.add("Download::PPMImage",this.downloadPPMImage.bind(this)),this.offscreen?n.transfer(e.transferControlToOffscreen(),{tracer:i,backEnd:r,pixelRatio:a}):new rt({canvas:e,worker:n,tracer:i,backEnd:r,pixelRatio:a})}),!this.offscreen&&T.add("Download::PPMImage",this.downloadPPMImage.bind(this))}downloadPPMImage(t){const{image:e}=t.data;this.client.downloadImage(e)}}const Nt=vt('<section><canvas data-tracer="typescript"></canvas><canvas data-tracer="assemblyscript">'),Gt=()=>{let s,t;return lt(()=>new Ft([s,t])),(()=>{const e=Nt(),n=e.firstChild,i=n.nextSibling,r=s;typeof r=="function"?V(r,n):s=n;const a=t;return typeof a=="function"?V(a,i):t=i,P(o=>{const l=u.height,h=u.width,c=u.height,f=u.width;return l!==o._v$&&E(n,"height",o._v$=l),h!==o._v$2&&E(n,"width",o._v$2=h),c!==o._v$3&&E(i,"height",o._v$3=c),f!==o._v$4&&E(i,"width",o._v$4=f),o},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),e})()};mt(()=>pt(Gt,{}),document.getElementById("root"));export{u as C,G as V,R as _,Wt as d,Vt as f,k as r};
