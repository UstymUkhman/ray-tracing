(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();const Zt=(s,t)=>s===t,gt={equals:Zt};let Tt=$t;const b=1,U=2,Ct={owned:null,cleanups:null,context:null,owner:null};var d=null;let H=null,f=null,p=null,y=null,F=0;function Jt(s,t){const e=f,r=d,n=s.length===0,i=n?Ct:{owned:null,cleanups:null,context:null,owner:t===void 0?r:t},o=n?s:()=>s(()=>P(()=>B(i)));d=i,f=null;try{return R(o,!0)}finally{f=e,d=r}}function $(s,t){t=t?Object.assign({},gt,t):gt;const e={value:s,observers:null,observerSlots:null,comparator:t.equals||void 0},r=n=>(typeof n=="function"&&(n=n(e.value)),At(e,n));return[re.bind(e),r]}function E(s,t,e){const r=Pt(s,t,!1,b);O(r)}function te(s,t,e){Tt=oe;const r=Pt(s,t,!1,b);(!e||!e.render)&&(r.user=!0),y?y.push(r):O(r)}function P(s){if(f===null)return s();const t=f;f=null;try{return s()}finally{f=t}}function ee(s){te(()=>P(s))}function se(s){return d===null||(d.cleanups===null?d.cleanups=[s]:d.cleanups.push(s)),s}function re(){if(this.sources&&this.state)if(this.state===b)O(this);else{const s=p;p=null,R(()=>N(this),!1),p=s}if(f){const s=this.observers?this.observers.length:0;f.sources?(f.sources.push(this),f.sourceSlots.push(s)):(f.sources=[this],f.sourceSlots=[s]),this.observers?(this.observers.push(f),this.observerSlots.push(f.sources.length-1)):(this.observers=[f],this.observerSlots=[f.sources.length-1])}return this.value}function At(s,t,e){let r=s.value;return(!s.comparator||!s.comparator(r,t))&&(s.value=t,s.observers&&s.observers.length&&R(()=>{for(let n=0;n<s.observers.length;n+=1){const i=s.observers[n],o=H&&H.running;o&&H.disposed.has(i),(o?!i.tState:!i.state)&&(i.pure?p.push(i):y.push(i),i.observers&&Rt(i)),o||(i.state=b)}if(p.length>1e6)throw p=[],new Error},!1)),t}function O(s){if(!s.fn)return;B(s);const t=d,e=f,r=F;f=d=s,ne(s,s.value,r),f=e,d=t}function ne(s,t,e){let r;try{r=s.fn(t)}catch(n){return s.pure&&(s.state=b,s.owned&&s.owned.forEach(B),s.owned=null),s.updatedAt=e+1,Lt(n)}(!s.updatedAt||s.updatedAt<=e)&&(s.updatedAt!=null&&"observers"in s?At(s,r):s.value=r,s.updatedAt=e)}function Pt(s,t,e,r=b,n){const i={fn:s,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:d,context:null,pure:e};return d===null||d!==Ct&&(d.owned?d.owned.push(i):d.owned=[i]),i}function D(s){if(s.state===0)return;if(s.state===U)return N(s);if(s.suspense&&P(s.suspense.inFallback))return s.suspense.effects.push(s);const t=[s];for(;(s=s.owner)&&(!s.updatedAt||s.updatedAt<F);)s.state&&t.push(s);for(let e=t.length-1;e>=0;e--)if(s=t[e],s.state===b)O(s);else if(s.state===U){const r=p;p=null,R(()=>N(s,t[0]),!1),p=r}}function R(s,t){if(p)return s();let e=!1;t||(p=[]),y?e=!0:y=[],F++;try{const r=s();return ie(e),r}catch(r){e||(y=null),p=null,Lt(r)}}function ie(s){if(p&&($t(p),p=null),s)return;const t=y;y=null,t.length&&R(()=>Tt(t),!1)}function $t(s){for(let t=0;t<s.length;t++)D(s[t])}function oe(s){let t,e=0;for(t=0;t<s.length;t++){const r=s[t];r.user?s[e++]=r:D(r)}for(t=0;t<e;t++)D(s[t])}function N(s,t){s.state=0;for(let e=0;e<s.sources.length;e+=1){const r=s.sources[e];if(r.sources){const n=r.state;n===b?r!==t&&(!r.updatedAt||r.updatedAt<F)&&D(r):n===U&&N(r,t)}}}function Rt(s){for(let t=0;t<s.observers.length;t+=1){const e=s.observers[t];e.state||(e.state=U,e.pure?p.push(e):y.push(e),e.observers&&Rt(e))}}function B(s){let t;if(s.sources)for(;s.sources.length;){const e=s.sources.pop(),r=s.sourceSlots.pop(),n=e.observers;if(n&&n.length){const i=n.pop(),o=e.observerSlots.pop();r<n.length&&(i.sourceSlots[o]=r,n[r]=i,e.observerSlots[r]=o)}}if(s.owned){for(t=s.owned.length-1;t>=0;t--)B(s.owned[t]);s.owned=null}if(s.cleanups){for(t=s.cleanups.length-1;t>=0;t--)s.cleanups[t]();s.cleanups=null}s.state=0,s.context=null}function Lt(s){throw s}function M(s,t){return P(()=>s(t||{}))}function ae(s,t,e){let r=e.length,n=t.length,i=r,o=0,a=0,c=t[n-1].nextSibling,h=null;for(;o<n||a<i;){if(t[o]===e[a]){o++,a++;continue}for(;t[n-1]===e[i-1];)n--,i--;if(n===o){const l=i<r?a?e[a-1].nextSibling:e[i-a]:c;for(;a<i;)s.insertBefore(e[a++],l)}else if(i===a)for(;o<n;)(!h||!h.has(t[o]))&&t[o].remove(),o++;else if(t[o]===e[i-1]&&e[a]===t[n-1]){const l=t[--n].nextSibling;s.insertBefore(e[a++],t[o++].nextSibling),s.insertBefore(e[--i],l),t[n]=e[i]}else{if(!h){h=new Map;let m=a;for(;m<i;)h.set(e[m],m++)}const l=h.get(t[o]);if(l!=null)if(a<l&&l<i){let m=o,x=1,T;for(;++m<n&&m<i&&!((T=h.get(t[m]))==null||T!==l+x);)x++;if(x>l-a){const W=t[o];for(;a<l;)s.insertBefore(e[a++],W)}else s.replaceChild(e[a++],t[o++])}else o++;else t[o++].remove()}}}const pt="_$DX_DELEGATE";function ce(s,t,e,r={}){let n;return Jt(i=>{n=i,t===document?s():v(t,s(),t.firstChild?null:void 0,e)},r.owner),()=>{n(),t.textContent=""}}function L(s,t,e){let r;const n=()=>{const o=document.createElement("template");return o.innerHTML=s,e?o.content.firstChild.firstChild:o.content.firstChild},i=t?()=>(r||(r=n())).cloneNode(!0):()=>P(()=>document.importNode(r||(r=n()),!0));return i.cloneNode=i,i}function le(s,t=window.document){const e=t[pt]||(t[pt]=new Set);for(let r=0,n=s.length;r<n;r++){const i=s[r];e.has(i)||(e.add(i),t.addEventListener(i,he))}}function C(s,t,e){e==null?s.removeAttribute(t):s.setAttribute(t,e)}function mt(s,t){t==null?s.removeAttribute("class"):s.className=t}function V(s,t,e){return P(()=>s(t,e))}function v(s,t,e,r){if(e!==void 0&&!r&&(r=[]),typeof t!="function")return k(s,t,r,e);E(n=>k(s,t(),n,e),r)}function he(s){const t=`$$${s.type}`;let e=s.composedPath&&s.composedPath()[0]||s.target;for(s.target!==e&&Object.defineProperty(s,"target",{configurable:!0,value:e}),Object.defineProperty(s,"currentTarget",{configurable:!0,get(){return e||document}});e;){const r=e[t];if(r&&!e.disabled){const n=e[`${t}Data`];if(n!==void 0?r.call(e,n,s):r.call(e,s),s.cancelBubble)return}e=e._$host||e.parentNode||e.host}}function k(s,t,e,r,n){for(;typeof e=="function";)e=e();if(t===e)return e;const i=typeof t,o=r!==void 0;if(s=o&&e[0]&&e[0].parentNode||s,i==="string"||i==="number")if(i==="number"&&(t=t.toString()),o){let a=e[0];a&&a.nodeType===3?a.data=t:a=document.createTextNode(t),e=A(s,e,r,a)}else e!==""&&typeof e=="string"?e=s.firstChild.data=t:e=s.textContent=t;else if(t==null||i==="boolean")e=A(s,e,r);else{if(i==="function")return E(()=>{let a=t();for(;typeof a=="function";)a=a();e=k(s,a,e,r)}),()=>e;if(Array.isArray(t)){const a=[],c=e&&Array.isArray(e);if(J(a,t,e,n))return E(()=>e=k(s,a,e,r,!0)),()=>e;if(a.length===0){if(e=A(s,e,r),o)return e}else c?e.length===0?vt(s,a,r):ae(s,e,a):(e&&A(s),vt(s,a));e=a}else if(t.nodeType){if(Array.isArray(e)){if(o)return e=A(s,e,r,t);A(s,e,null,t)}else e==null||e===""||!s.firstChild?s.appendChild(t):s.replaceChild(t,s.firstChild);e=t}else console.warn("Unrecognized value. Skipped inserting",t)}return e}function J(s,t,e,r){let n=!1;for(let i=0,o=t.length;i<o;i++){let a=t[i],c=e&&e[i],h;if(!(a==null||a===!0||a===!1))if((h=typeof a)=="object"&&a.nodeType)s.push(a);else if(Array.isArray(a))n=J(s,a,c)||n;else if(h==="function")if(r){for(;typeof a=="function";)a=a();n=J(s,Array.isArray(a)?a:[a],Array.isArray(c)?c:[c])||n}else s.push(a),n=!0;else{const l=String(a);c&&c.nodeType===3&&c.data===l?s.push(c):s.push(document.createTextNode(l))}}return n}function vt(s,t,e=null){for(let r=0,n=t.length;r<n;r++)s.insertBefore(t[r],e)}function A(s,t,e,r){if(e===void 0)return s.textContent="";const n=r||document.createTextNode("");if(t.length){let i=!1;for(let o=t.length-1;o>=0;o--){const a=t[o];if(n!==a){const c=a.parentNode===s;!i&&!o?c?s.replaceChild(n,a):s.insertBefore(n,e):c&&a.remove()}else i=!0}}else s.insertBefore(n,e);return[n]}const j=(s,t=0,e=1)=>Math.max(t,Math.min(s,e)),X=(s,t)=>Math.random()*(t-s)+s,Oe=s=>s*Math.PI/180,xt=(s,t=2)=>{const e=Math.pow(10,t);return~~(e*s)/e},fe=1/.06,ue="modulepreload",de=function(s,t){return new URL(s,t).href},wt={},G=function(t,e,r){if(!e||e.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(e.map(i=>{if(i=de(i,r),i in wt)return;wt[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let l=n.length-1;l>=0;l--){const m=n[l];if(m.href===i&&(!o||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const h=document.createElement("link");if(h.rel=o?"stylesheet":ue,o||(h.as="script",h.crossOrigin=""),h.href=i,document.head.appendChild(h),o)return new Promise((l,m)=>{h.addEventListener("load",l),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>t())},ge=`#version 300 es

precision mediump float;

uniform vec2 resolution;

in  vec2 position;
in  vec2 coords;
out vec2 uv;

void main (void)
{
  gl_Position = vec4((
    position / resolution * 2.0 - 1.0
  ) * vec2(1.0, -1.0), 0.0, 1.0);

  uv = coords;
}
`,pe=`#version 300 es

#ifndef GL_FRAGMENT_PRECISION_HIGH
  precision mediump float;
#else
  precision highp float;
#endif

uniform sampler2D tex;

in  vec2 uv;
out vec4 fragColor;

void main (void)
{
  fragColor = texture(tex, uv);
}
`,me=`#ifndef GL_FRAGMENT_PRECISION_HIGH
  precision mediump float;
#else
  precision highp float;
#endif

uniform sampler2D tex;

varying vec2 uv;

void main (void)
{
  gl_FragColor = texture2D(tex, uv);
}
`,ve=`precision mediump float;

uniform vec2 resolution;

attribute vec2 position;
attribute vec2 coords;
varying   vec2 uv;

void main (void)
{
  gl_Position = vec4((
    position / resolution * 2.0 - 1.0
  ) * vec2(1.0, -1.0), 0.0, 1.0);

  uv = coords;
}
`;class It{context;clearColor=0;channels;height;width;side;constructor(t){const{canvas:e,context:r,offscreen:n}=t;this.channels=+(r==="Canvas2D")+3,this.context=e.getContext(this.getContextId(r),this.getOptions(r,n)),this.width=e.width,this.height=e.height,this.side=this.width*this.channels}getContextId(t){switch(t){case"WebGPU":return"webgpu";case"WebGL2":return"webgl2";case"WebGL":return"webgl";default:return"2d"}}getOptions(t,e=!1){switch(t){case"Canvas2D":return{willReadFrequently:!e,desynchronized:e,colorSpace:"srgb",alpha:!1};case"WebGPU":return{};default:return{powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!1,desynchronized:!e,premultipliedAlpha:!1,antialias:!0,stencil:!1,depth:!1,alpha:!1}}}getPixel(t,e){return e*this.side+t*this.channels}}class tt{vec=[0,0,0];constructor(t=0,e=t,r=t){this.vec[0]=t,this.vec[1]=e,this.vec[2]=r}refract(t,e){const r=Math.min(this.clone.negate.dot(t),1);this.copy(t.clone.multiply(r).add(this).multiply(e));const n=Math.abs(1-this.lengthSquared);return this.add(t.multiply(-Math.sqrt(n)))}set(t,e,r){return this.vec[0]=t,this.vec[1]=e,this.vec[2]=r,this}multiply(t){if(typeof t!="number")return this.set(this.vec[0]*t.x,this.vec[1]*t.y,this.vec[2]*t.z);const e=t;return this.vec[0]*=e,this.vec[1]*=e,this.vec[2]*=e,this}divide(t){return typeof t=="number"?this.multiply(1/t):this.set(this.vec[0]/t.x,this.vec[1]/t.y,this.vec[2]/t.z)}random(t=0,e=1){return this.set(X(t,e),X(t,e),X(t,e))}reflect(t){return this.sub(t.clone.multiply(this.dot(t)*2))}get randomNormalized(){return this.randomUnitSphere.normalize}get randomUnitSphere(){for(;;)if(this.random(-1).lengthSquared<1)return this}get lengthSquared(){return this.dot(this)}get randomUnitDisk(){for(;;)if(this.random(-1),this.vec[2]=0,this.lengthSquared<1)return this}cross(t){return this.set(this.vec[1]*t.z-this.vec[2]*t.y,this.vec[2]*t.x-this.vec[0]*t.z,this.vec[0]*t.y-this.vec[1]*t.x)}dot(t){return this.vec[0]*t.x+this.vec[1]*t.y+this.vec[2]*t.z}copy(t){const{x:e,y:r,z:n}=t;return this.set(e,r,n)}add(t){return this.vec[0]+=t.x,this.vec[1]+=t.y,this.vec[2]+=t.z,this}sub(t){return this.vec[0]-=t.x,this.vec[1]-=t.y,this.vec[2]-=t.z,this}get nearZero(){return Math.abs(this.vec[0])<1e-8&&Math.abs(this.vec[1])<1e-8&&Math.abs(this.vec[2])<1e-8}get normalize(){return this.divide(this.length)}get length(){return Math.sqrt(this.lengthSquared)}get clone(){return new tt(this.vec[0],this.vec[1],this.vec[2])}reset(t=0){return this.set(t,t,t)}get negate(){return this.multiply(-1)}get sqrt(){return this.set(Math.sqrt(this.vec[0]),Math.sqrt(this.vec[1]),Math.sqrt(this.vec[2]))}get rgb(){return this.set(j(this.vec[0]*256|0,0,255),j(this.vec[1]*256|0,0,255),j(this.vec[2]*256|0,0,255))}get x(){return this.vec[0]}get y(){return this.vec[1]}get z(){return this.vec[2]}}const xe=(s,t=1)=>new Map([["r",s>>16&t],["g",s>>8&t],["b",s&t]]),we=(s,t)=>s.divide(t).sqrt.rgb,ye=s=>`#${`000000${s.toString(16)}`.slice(-6)}`,Be=(s,t,e)=>{const r=new tt;for(let n=0;n<s.length;n+=3){const{x:i,y:o,z:a}=we(r.set(s[n],s[n+1],s[n+2]),e);t[n]=i,t[n+1]=o,t[n+2]=a}return t};class Mt extends It{textureData=new Uint8ClampedArray(this.width*this.height*this.channels);texture;program;constructor(t,e=me,r=ve){super(t),this.createProgram(e,r),this.createScene()}loadShader(t,e){const r=this.context.createShader(e);return this.context.shaderSource(r,t),this.context.compileShader(r),this.context.getShaderParameter(r,this.context.COMPILE_STATUS)?r:(console.error(`An error occurred compiling the shaders: ${this.context.getShaderInfoLog(r)}`),this.context.deleteShader(r))}setBufferData(t=this.width,e=this.height){this.context.bufferData(this.context.ARRAY_BUFFER,new Float32Array([0,0,t,0,0,e,0,e,t,0,t,e]),this.context.STATIC_DRAW)}createProgram(t,e){const r=this.loadShader(t,this.context.FRAGMENT_SHADER),n=this.loadShader(e,this.context.VERTEX_SHADER);if(this.program=this.context.createProgram(),n&&r&&(this.context.attachShader(this.program,r),this.context.attachShader(this.program,n),this.context.linkProgram(this.program)),!this.context.getProgramParameter(this.program,this.context.LINK_STATUS))return console.error(`Unable to initialize shader program: ${this.context.getProgramInfoLog(this.program)}`);this.context.clear(this.context.COLOR_BUFFER_BIT);const i=xe(this.clearColor,1),o=i.get("r")??0,a=i.get("g")??0,c=i.get("b")??0;this.context.clearColor(o,a,c,1),this.context.useProgram(this.program)}updateTexture(){this.context.activeTexture(this.context.TEXTURE0),this.context.bindTexture(this.context.TEXTURE_2D,this.texture),this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGB,this.width,this.height,0,this.context.RGB,this.context.UNSIGNED_BYTE,this.textureData)}createScene(){const t=this.context.getAttribLocation(this.program,"coords");this.context.bindBuffer(this.context.ARRAY_BUFFER,this.context.createBuffer()),this.setBufferData(1,1),this.context.enableVertexAttribArray(t),this.context.vertexAttribPointer(t,2,this.context.FLOAT,!1,0,0);const e=this.context.getAttribLocation(this.program,"position");this.context.bindBuffer(this.context.ARRAY_BUFFER,this.context.createBuffer()),this.setBufferData(),this.context.enableVertexAttribArray(e),this.context.vertexAttribPointer(e,2,this.context.FLOAT,!1,0,0);const r=this.context.getUniformLocation(this.program,"resolution");this.context.uniform2f(r,this.width,this.height),this.texture=this.context.createTexture(),this.setBufferData(),this.updateTexture(),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.NEAREST),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MAG_FILTER,this.context.NEAREST)}drawImage(t){this.textureData=t,this.updateTexture(),this.context.drawArrays(this.context.TRIANGLES,0,6)}clear(){this.context.clear(this.context.COLOR_BUFFER_BIT)}}class Ut extends Mt{cpuScene=!0;constructor(t,e=pe){super(t,e,ge),this.cpuScene=t.tracer!=="WebGL2"}drawImage(t){this.cpuScene?super.drawImage(t):this.context.drawArrays(this.context.TRIANGLES,0,6)}}class be extends It{image;constructor(t){super(t),this.context.imageSmoothingEnabled=!0,this.context.imageSmoothingQuality="high",this.image=this.context.getImageData(0,0,this.width,this.height)}drawImage(t){for(let e=0,r=0;e<t.length;e+=3,r+=4)this.image.data[r]=t[e],this.image.data[r+1]=t[e+1],this.image.data[r+2]=t[e+2],this.image.data[r+3]=255;this.context.putImageData(this.image,0,0)}clear(){this.context.fillStyle=ye(this.clearColor),this.context.clearRect(0,0,this.width,this.height),this.context.fillRect(0,0,this.width,this.height)}}const g={maxDepth:50,samples:500,height:240,width:360,log:!1};class Dt{sample=0;trace;format;collect;tracer;f32=new Float32Array(g.width*g.height*3);u8=new Uint8ClampedArray(g.width*g.height*3);canvas;worker;samples=g.samples;constructor(t){this.canvas=this.createCanvas(t),this.tracer=this.getTracer(t),(this.worker=t.worker)?this.createWorkerEvents():this.loadTracer(),this.canvas.clear()}createCanvas(t){switch(t.context){case"WebGL2":return new Ut(t);case"WebGL":return new Mt(t);default:return new be(t)}}getTracer(t){return t.tracer!=="AssemblyScript"?"TypeScript":"AssemblyScript"}createWorkerEvents(){this.worker?.post("Create::Tracer",{tracer:this.tracer}),this.worker?.add("Create::Tracer",()=>{this.worker?.add("Create::PPMImage",this.showPPMImage.bind(this)),u.dispatch(`${this.tracer}::Start`),this.createPPMImage()})}loadTracer(){(this.tracer==="AssemblyScript"?G(()=>import("./release-5b31b66b.js"),[],import.meta.url):G(()=>import("./Tracer-b3df8452.js"),[],import.meta.url)).then(({trace:t,format:e,collect:r})=>{u.dispatch(`${this.tracer}::Start`,null,!0),this.trace=t,this.format=e,this.collect=r,this.createPPMImage()})}createPPMImage(t=!1){if(this.worker)return this.worker.post("Create::PPMImage",{download:t});this.tracer==="AssemblyScript"?(this.f32=Float32Array.from(this.trace(this.f32)),this.u8=Uint8ClampedArray.from(this.format(this.f32,this.u8,++this.sample)),!(this.sample%100)&&this.collect()):this.format(this.trace(this.f32),this.u8,++this.sample),this.showPPMImage({pixels:this.u8,sample:this.sample,download:t},!0)}showPPMImage(t,e){const r=t;this.canvas.drawImage(r.pixels),this.samples===r.sample||!(this.worker?r.sample:this.sample)?r.download&&this.downloadPPMImage(r.pixels,e):setTimeout(this.createPPMImage.bind(this,r.download),fe),u.dispatch(`${this.tracer}::Stats::Update`,{sample:r.sample},e)}downloadPPMImage(t,e){let r=`P3
${this.canvas.width} ${this.canvas.height}
255
`;for(let n=0;n<t.length;n+=3)r+=`${t[n]} ${t[n+1]} ${t[n+2]}
`;u.dispatch("PPMImage::Download",{image:r},e)}}var Se=`#version 300 es
#ifndef GL_FRAGMENT_PRECISION_HIGH
precision mediump float;
#else
precision highp float;
#endif
struct Ray{vec3 origin;vec3 direction;};vec3 at(in Ray ray,in float t){return ray.origin+ray.direction*t;}struct Config{float width;float height;float maxDepth;uint samples;}config=Config(600.0,400.0,50.0,100u);struct Camera{vec3 origin;vec3 vertical;vec3 horizontal;vec3 lowerLeftCorner;}camera;void createCamera(){float ratio=config.width/config.height;vec2 viewport=vec2(ratio*2.0,2.0);const vec3 origin=vec3(0.0,0.0,0.0);vec3 vertical=vec3(0.0,viewport.y,0.0);vec3 horizontal=vec3(viewport.x,0.0,0.0);camera=Camera(origin,vertical,horizontal,origin-vertical/2.0-horizontal/2.0-vec3(0.0,0.0,1.0));}Ray getRay(in float u,in float v){return Ray(camera.origin,camera.lowerLeftCorner+camera.horizontal*u+camera.vertical*v-camera.origin);}void calcColor(inout vec3 color,const uint samples){color/=float(samples);}
#define INFINITY 1.0 / 0.0
#define PI 3.14159265358979323846
float random(in vec2 seed){return fract(sin(dot(seed.xy,vec2(12.9898,78.233)))*43758.5453123);}float random(in vec2 seed,in float mi,in float ma){return random(seed)*(ma-mi)+mi;}float degToRad(in float deg){return deg*PI/180.0;}vec3 rand(in vec2 co){return vec3(random(co),random(co),random(co));}float lengthSquared(in vec3 vec){return dot(vec,vec);}struct Record{float t;vec3 point;vec3 normal;bool frontFace;}record;void setFaceNormal(const in Ray ray,const in vec3 outwardNormal){record.frontFace=dot(ray.direction,outwardNormal)<0.0;record.normal=record.frontFace ? outwardNormal :-outwardNormal;}struct Sphere{vec3 center;float radius;};bool sphereHit(const in Ray ray,const in float tMin,const in float tMax,const in Sphere sphere){vec3 oc=ray.origin-sphere.center;float a=lengthSquared(ray.direction);float halfB=dot(oc,ray.direction);float c=lengthSquared(oc)-sphere.radius*sphere.radius;float d=halfB*halfB-a*c;if(d<0.0)return false;float sqrtD=sqrt(d);float root=(-halfB-sqrtD)/a;if(root<tMin||root>tMax){root=(-halfB+sqrtD)/a;if(root<tMin||root>tMax)return false;}record.t=root;record.point=at(ray,root);vec3 outwardNormal=(record.point-sphere.center)/sphere.radius;setFaceNormal(ray,outwardNormal);return true;}struct List{Sphere objects[2];uint length;}hittables;void listAdd(const in Sphere object){hittables.objects[hittables.length++]=object;}bool listHit(const in Ray ray,const in float tMin,const in float tMax){bool hit=false;float closest=tMax;for(uint o=0u,l=hittables.length;o<l;++o){Sphere sphere=hittables.objects[o];if(sphereHit(ray,tMin,tMax,sphere)){closest=record.t;hit=true;}}return hit;}in vec2 uv;out vec4 fragColor;vec3 getColor(in Ray ray){if(listHit(ray,0.001,INFINITY)){return(record.normal+vec3(1.0))*0.5;}vec3 direction=normalize(ray.direction);float t=(direction.y+1.0)*0.5;return(1.0-t)*vec3(1.0)+vec3(0.5,0.7,1.0)*t;}void main(void){createCamera();listAdd(Sphere(vec3(0.0,-100.5,-1.0),100.0));listAdd(Sphere(vec3(0.0,0.0,-1.0),0.5));vec2 res=vec2(config.width,config.height);vec2 coord=vec2(uv.x,1.0-uv.y)*res;vec3 color=vec3(0.0);uint samples=config.samples;for(uint s=0u;s<samples;s++){float x=random(uv*coord*float(s));float y=random(uv*coord*float(s));float u=(coord.x+x)/res.x;float v=(coord.y+y)/res.y;Ray ray=getRay(u,v);color+=getColor(ray);}calcColor(color,samples);fragColor=vec4(color,1.0);}`;class _e{canvas;constructor(t){this.canvas=this.createCanvas(t),this.canvas.clear(),this.canvas.drawImage()}createCanvas(t){switch(t.context){default:return new Ut(t,Se)}}}let Y=0,yt,bt,St,K=new Float32Array(g.width*g.height*3),Q=new Uint8ClampedArray(g.width*g.height*3);self.onerror=s=>console.error(s);self.onmessage=async s=>{const{event:t}=s.data;let{params:e}=s.data;switch(t){case"Transfer::Offscreen":return new Dt({offscreen:!0,...e});case"Create::Tracer":{const r=await(e.tracer==="AssemblyScript"?G(()=>import("./release-5b31b66b.js"),[],import.meta.url):G(()=>import("./Tracer-b3df8452.js"),[],import.meta.url));St=r.collect,bt=r.format,yt=r.trace;break}case"Create::PPMImage":{K=new Float32Array(yt(K)),Q=new Uint8ClampedArray(bt(K,Q,++Y)),e={sample:Y,pixels:Q,...e},!(Y%100)&&St();break}}self.postMessage({response:e,name:t})};const Ee=self;class Te extends CustomEvent{data}class Ce{target=new EventTarget;events=new Map;callbacks=new Map;add(t,e){const r=this.callbacks.get(t);r?r.push(e):this.callbacks.set(t,[e]),this.events.set(t,new Te(t)),this.target.addEventListener(t,e,!1)}dispatch(t,e){const r=this.events.get(t);r&&(r.data=e,this.target.dispatchEvent(r))}remove(t,e){const r=this.callbacks.get(t);if(r&&e){const n=r.indexOf(e),i=e;n!==-1&&r.splice(n,1),this.target.removeEventListener(t,i,!1)}e||(r?.forEach(n=>this.target.removeEventListener(t,n,!1)),this.callbacks.delete(t),this.events.delete(t))}dispose(){this.callbacks.clear(),this.events.clear()}}class _t{constructor(t){this.worker=t}add(t,e){this.worker.add(t,e)}static dispatch(t,e){Ee.postMessage({name:t,response:{data:e}})}remove(t){this.worker.remove(t)}dispose(){this.worker.dispose()}}class Ae extends Ce{offscreen=!1;workerEvents;createWorkerEvents(t,e){this.workerEvents=new _t(t),this.offscreen=e}add(t,e){this.offscreen?this.workerEvents?.add(t,e):super.add(t,e)}dispatch(t,e,r=!1){r?_t.dispatch(t,e):super.dispatch(t,e)}remove(t,e){this.offscreen?this.workerEvents?.remove(t):super.remove(t,e)}dispose(){this.workerEvents?.dispose(),super.dispose()}}const u=new Ae,Pe="_container_6bmez_1",$e="_stats_6bmez_6",Et={container:Pe,stats:$e},Re=L("<div><ul><li><strong>Processing: </strong><em></em></li><li><strong>Context: </strong><em></em></li><li><strong>Language: </strong><em></em></li><li><strong>Environment: </strong><em></em></li><li><strong>Samples: </strong><em> / </em></li><li><strong>Last Render Time: </strong><em>~<!> sec.</em></li><li><strong>Total Render Time: </strong><em>~<!> sec."),Z=s=>{let t=Date.now(),e=Date.now();const[r,n]=$(0),[i,o]=$(!1),[a,c]=$(0),[h,l]=$(0),m=s.children,{tracer:x,processing:T,context:W}=m.dataset,Nt=()=>o(!i()),et=()=>e=Date.now(),st=S=>{const w=Date.now(),{sample:I}=S.data;l(xt((w-e)/1e3)),c(xt((w-t)/1e3)),n(I),t=w};return u.add(`${x}::Start`,et),u.add(`${x}::Stats::Update`,st),se(()=>{u.remove(`${x}::Start`,et),u.remove(`${x}::Stats::Update`,st)}),(()=>{const S=Re(),w=S.firstChild,I=w.firstChild,kt=I.firstChild,Gt=kt.nextSibling,rt=I.nextSibling,Ft=rt.firstChild,Ot=Ft.nextSibling,nt=rt.nextSibling,Bt=nt.firstChild,Wt=Bt.nextSibling,it=nt.nextSibling,qt=it.firstChild,zt=qt.nextSibling,ot=it.nextSibling,Ht=ot.firstChild,q=Ht.nextSibling,Vt=q.firstChild,at=ot.nextSibling,jt=at.firstChild,ct=jt.nextSibling,Xt=ct.firstChild,lt=Xt.nextSibling;lt.nextSibling;const Yt=at.nextSibling,Kt=Yt.firstChild,ht=Kt.nextSibling,Qt=ht.firstChild,ft=Qt.nextSibling;return ft.nextSibling,S.$$click=Nt,v(S,()=>s.children,w),v(Gt,T),v(Ot,W),v(Wt,T==="CPU"?x:x==="WebGL2"?"OpenGL ES 3.0":"WGSL"),v(zt,()=>T==="GPU"?"Client":s.offscreen?"OffscreenCanvas":"Web Worker"),v(q,r,Vt),v(q,()=>g.samples,null),v(ct,a,lt),v(ht,h,ft),E(_=>{const ut=Et.container,dt=Et.stats,z=+i();return ut!==_._v$&&mt(S,_._v$=ut),dt!==_._v$2&&mt(w,_._v$2=dt),z!==_._v$3&&((_._v$3=z)!=null?w.style.setProperty("opacity",z):w.style.removeProperty("opacity")),_},{_v$:void 0,_v$2:void 0,_v$3:void 0}),S})()};le(["click"]);const Le=(s,t="image")=>{const e=document.createElement("a");e.href=URL.createObjectURL(new Blob([s],{type:"text/plain; charset=UTF-8"})),e.download=`${t}.ppm`,e.click(),URL.revokeObjectURL(e.href)};function Ie(){return new Worker(""+new URL("worker-6356b110.js",import.meta.url).href,{type:"module"})}class Me{worker=new Ie;events=new Map;constructor(){this.worker.onmessage=this.onMessage.bind(this),this.worker.onerror=this.onError.bind(this)}add(t,e,r){this.events.set(t,{callback:e,params:r})}transfer(t,e){this.worker.postMessage({event:"Transfer::Offscreen",params:{canvas:t,...e}},[t])}post(t,e){const r=this.events.get(t)?.params;this.worker.postMessage({event:t,params:{...r,...e}})}onMessage(t){const{name:e,response:r}=t.data;this.events?.get(e)?.callback?.(r)}onError(t){console.error(t)}remove(t){this.events.delete(t)}dispose(){this.events.clear()}}class Ue{offscreen=typeof HTMLCanvasElement<"u"&&!!HTMLCanvasElement.prototype.transferControlToOffscreen;constructor(t){t.forEach(e=>{const{processing:r,tracer:n}=e.dataset,i=e.dataset.context;if(r==="GPU")return new _e({canvas:e,tracer:n,context:i});const o=new Me;return u.createWorkerEvents(o,this.offscreen),this.offscreen?(u.add("PPMImage::Download",this.downloadPPMImage.bind(this)),u.add("AssemblyScript::Stats::Update",a=>this.updateStats(a,"AssemblyScript")),u.add("TypeScript::Stats::Update",a=>this.updateStats(a,"TypeScript")),u.add("AssemblyScript::Start",this.startStats.bind(this,"AssemblyScript")),u.add("TypeScript::Start",this.startStats.bind(this,"TypeScript")),o.transfer(e.transferControlToOffscreen(),{tracer:n,context:i})):new Dt({canvas:e,worker:o,tracer:n,context:i})}),!this.offscreen&&u.add("PPMImage::Download",this.downloadPPMImage.bind(this))}updateStats(t,e){this.offscreen&&u.dispatch(`${e}::Stats::Update`,t.data)}downloadPPMImage(t){Le(t.data.image)}startStats(t){this.offscreen&&u.dispatch(`${t}::Start`)}}const De=L('<canvas data-tracer="TypeScript" data-processing="CPU" data-context="WebGL2">'),Ne=L('<canvas data-tracer="AssemblyScript" data-processing="CPU" data-context="WebGL2">'),ke=L('<canvas data-processing="GPU" data-context="WebGL2" data-tracer="WebGL2">'),Ge=L("<section>"),Fe=()=>{let s,t,e;const[r,n]=$(!1);return ee(()=>n(new Ue([s,t,e]).offscreen)),(()=>{const i=Ge();return v(i,M(Z,{get offscreen(){return r()},get children(){const o=De(),a=t;return typeof a=="function"?V(a,o):t=o,E(c=>{const h=g.height,l=g.width;return h!==c._v$&&C(o,"height",c._v$=h),l!==c._v$2&&C(o,"width",c._v$2=l),c},{_v$:void 0,_v$2:void 0}),o}}),null),v(i,M(Z,{get offscreen(){return r()},get children(){const o=Ne(),a=e;return typeof a=="function"?V(a,o):e=o,E(c=>{const h=g.height,l=g.width;return h!==c._v$3&&C(o,"height",c._v$3=h),l!==c._v$4&&C(o,"width",c._v$4=l),c},{_v$3:void 0,_v$4:void 0}),o}}),null),v(i,M(Z,{get children(){const o=ke(),a=s;return typeof a=="function"?V(a,o):s=o,E(c=>{const h=g.height,l=g.width;return h!==c._v$5&&C(o,"height",c._v$5=h),l!==c._v$6&&C(o,"width",c._v$6=l),c},{_v$5:void 0,_v$6:void 0}),o}}),null),i})()};ce(()=>M(Fe,{}),document.getElementById("root"));export{g as C,tt as V,G as _,Oe as d,Be as f,X as r};
