var pt=Object.defineProperty;var mt=(f,m,u)=>m in f?pt(f,m,{enumerable:!0,configurable:!0,writable:!0,value:u}):f[m]=u;var n=(f,m,u)=>(mt(f,typeof m!="symbol"?m+"":m,u),u);(function(){"use strict";var f=`#version 300 es

precision mediump float;

uniform vec2 resolution;

in  vec2 position;
in  vec2 coords;
out vec2 uv;

void main (void)
{
  gl_Position = vec4((
    position / resolution * 2.0 - 1.0
  ) * vec2(1.0, -1.0), 0.0, 1.0);

  uv = coords;
}
`,m=`#version 300 es

#ifndef GL_FRAGMENT_PRECISION_HIGH
  precision mediump float;
#else
  precision highp float;
#endif

uniform sampler2D tex;

in  vec2 uv;
out vec4 fragColor;

void main (void)
{
  fragColor = texture(tex, uv);
}
`;const u=(r,t=0,e=1)=>Math.max(t,Math.min(r,e)),x=(r,t)=>Math.random()*(t-r)+r,B=r=>r*Math.PI/180,E=(r,t=2)=>{const e=Math.pow(10,t);return~~(e*r)/e},q=16.666666666666668,R=(r,t,e,s)=>{for(let i=0;i<r.length;i+=3){e.set(r[i],r[i+1],r[i+2]);const{x:o,y:h,z:c}=O(e,s);t[i]=o,t[i+1]=h,t[i+2]=c}},G=(r,t=1)=>(r=typeof r=="string"?V(r):r,{r:r>>16&t,g:r>>8&t,b:r&t}),I=r=>(r=typeof r=="number"?r:N(r),`#${`000000${r.toString(16)}`.slice(-6)}`),V=r=>(r=typeof r=="string"?r:I(r),parseInt(r.slice(1),16)),O=(r,t)=>r.divide(t).sqrt.rgb,N=({r,g:t,b:e})=>u(r*255,0,255)<<16^u(t*255,0,255)<<8^u(e*255,0,255)<<0;class A{constructor(t,e){n(this,"context");n(this,"backEnd");n(this,"clearColor",0);n(this,"channels");n(this,"height");n(this,"width");n(this,"side");this.backEnd=e;const s=e==="2d",{canvas:i,offscreen:o}=t;this.context=i.getContext(e,this.getOptions(e,o)),this.width=i.width,this.height=i.height,this.channels=+s+3,this.side=this.width*this.channels}getOptions(t,e=!1){switch(t){case"2d":return{willReadFrequently:!e,desynchronized:e,colorSpace:"srgb",alpha:!1};case"webgpu":return{};default:return{powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!1,desynchronized:!e,premultipliedAlpha:!1,antialias:!0,stencil:!1,depth:!1,alpha:!1}}}getPixel(t,e){return e*this.side+t*this.channels}}var W=`precision mediump float;

uniform vec2 resolution;

attribute vec2 position;
attribute vec2 coords;
varying   vec2 uv;

void main (void)
{
  gl_Position = vec4((
    position / resolution * 2.0 - 1.0
  ) * vec2(1.0, -1.0), 0.0, 1.0);

  uv = coords;
}
`,X=`#ifndef GL_FRAGMENT_PRECISION_HIGH
  precision mediump float;
#else
  precision highp float;
#endif

uniform sampler2D tex;

varying vec2 uv;

void main (void)
{
  gl_FragColor = texture2D(tex, uv);
}
`;class D extends A{constructor(e,s="webgl",i=X,o=W){super(e,s);n(this,"textureData",new Uint8ClampedArray(this.width*this.height*this.channels));n(this,"texture");n(this,"program");this.createProgram(i,o),this.createScene()}loadShader(e,s){const i=this.context.createShader(s);return this.context.shaderSource(i,e),this.context.compileShader(i),this.context.getShaderParameter(i,this.context.COMPILE_STATUS)?i:(console.error(`An error occurred compiling the shaders: ${this.context.getShaderInfoLog(i)}`),this.context.deleteShader(i))}setBufferData(e=this.width,s=this.height){this.context.bufferData(this.context.ARRAY_BUFFER,new Float32Array([0,0,e,0,0,s,0,s,e,0,e,s]),this.context.STATIC_DRAW)}createProgram(e,s){const i=this.loadShader(e,this.context.FRAGMENT_SHADER),o=this.loadShader(s,this.context.VERTEX_SHADER);if(this.program=this.context.createProgram(),o&&i&&(this.context.attachShader(this.program,i),this.context.attachShader(this.program,o),this.context.linkProgram(this.program)),!this.context.getProgramParameter(this.program,this.context.LINK_STATUS))return console.error(`Unable to initialize shader program: ${this.context.getProgramInfoLog(this.program)}`);this.context.clear(this.context.COLOR_BUFFER_BIT);const{r:h,g:c,b:l}=G(this.clearColor,1);this.context.clearColor(h,c,l,1),this.context.useProgram(this.program)}updateTexture(){this.context.activeTexture(this.context.TEXTURE0),this.context.bindTexture(this.context.TEXTURE_2D,this.texture),this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGB,this.width,this.height,0,this.context.RGB,this.context.UNSIGNED_BYTE,this.textureData)}createScene(){const e=this.context.getAttribLocation(this.program,"coords");this.context.bindBuffer(this.context.ARRAY_BUFFER,this.context.createBuffer()),this.setBufferData(1,1),this.context.enableVertexAttribArray(e),this.context.vertexAttribPointer(e,2,this.context.FLOAT,!1,0,0);const s=this.context.getAttribLocation(this.program,"position");this.context.bindBuffer(this.context.ARRAY_BUFFER,this.context.createBuffer()),this.setBufferData(),this.context.enableVertexAttribArray(s),this.context.vertexAttribPointer(s,2,this.context.FLOAT,!1,0,0);const i=this.context.getUniformLocation(this.program,"resolution");this.context.uniform2f(i,this.width,this.height),this.texture=this.context.createTexture(),this.setBufferData(),this.updateTexture(),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.NEAREST),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MAG_FILTER,this.context.NEAREST)}drawImage(e){this.textureData=e,this.updateTexture(),this.context.drawArrays(this.context.TRIANGLES,0,6)}clear(){this.context.clear(this.context.COLOR_BUFFER_BIT)}}class H extends D{constructor(t){super(t,"webgl2",m,f)}}class j extends A{constructor(e){super(e,"2d");n(this,"image");this.context.imageSmoothingEnabled=!0,this.context.imageSmoothingQuality="high",this.image=this.context.getImageData(0,0,this.width,this.height)}drawImage(e){for(let s=0,i=0;s<e.length;s+=3,i+=4)this.image.data[i]=e[s],this.image.data[i+1]=e[s+1],this.image.data[i+2]=e[s+2],this.image.data[i+3]=255;this.context.putImageData(this.image,0,0)}clear(){this.context.fillStyle=I(this.clearColor),this.context.clearRect(0,0,this.width,this.height),this.context.fillRect(0,0,this.width,this.height)}}var d={backEnd:"webgl2",pixelRatio:1,maxDepth:50,samples:500,height:240,width:360};class a{constructor(t=0,e,s){n(this,"vec",[0,0,0]);this.vec[0]=t,this.vec[1]=e??t,this.vec[2]=s??t}multiply(t){if(typeof t!="number")return this.set(this.vec[0]*t.x,this.vec[1]*t.y,this.vec[2]*t.z);const e=t;return this.vec[0]*=e,this.vec[1]*=e,this.vec[2]*=e,this}divide(t){return typeof t=="number"?this.multiply(1/t):this.set(this.vec[0]/t.x,this.vec[1]/t.y,this.vec[2]/t.z)}get(t){return t===void 0?this.vec:this.vec[t]}refract(t,e){const s=Math.min(this.clone.negate.dot(t),1);this.copy(t.clone.multiply(s).add(this).multiply(e));const i=Math.abs(1-this.lengthSquared);return this.add(t.multiply(-Math.sqrt(i)))}set(t,e,s){return this.vec[0]=t,this.vec[1]=e,this.vec[2]=s,this}randomHemisphere(t){return this.randomUnitSphere,this.dot(t)>0?this:this.negate}random(t=0,e=1){return this.set(x(t,e),x(t,e),x(t,e))}reflect(t){return this.sub(t.clone.multiply(this.dot(t)*2))}get randomUnitVector(){return this.randomUnitSphere.unitVector}get randomUnitSphere(){for(;;)if(this.random(-1).lengthSquared<1)return this}get lengthSquared(){return this.dot(this)}get randomUnitDisk(){for(;;)if(this.random(-1),this.vec[2]=0,this.lengthSquared<1)return this}cross(t){return this.set(this.vec[1]*t.z-this.vec[2]*t.y,this.vec[2]*t.x-this.vec[0]*t.z,this.vec[0]*t.y-this.vec[1]*t.x)}dot(t){return this.vec[0]*t.x+this.vec[1]*t.y+this.vec[2]*t.z}copy(t){const{x:e,y:s,z:i}=t;return this.set(e,s,i)}add(t){return this.vec[0]+=t.x,this.vec[1]+=t.y,this.vec[2]+=t.z,this}sub(t){return this.vec[0]-=t.x,this.vec[1]-=t.y,this.vec[2]-=t.z,this}get nearZero(){return Math.abs(this.vec[0])<1e-8&&Math.abs(this.vec[1])<1e-8&&Math.abs(this.vec[2])<1e-8}get unitVector(){return this.divide(this.length)}get length(){return Math.sqrt(this.lengthSquared)}get clone(){return new a(this.vec[0],this.vec[1],this.vec[2])}reset(t=0){return this.set(t,t,t)}get print(){const[t,e,s]=this.vec;return`Vector3 { x: ${t}, y: ${e}, z: ${s} }`}get negate(){return this.vec[0]*=-1,this.vec[1]*=-1,this.vec[2]*=-1,this}get sqrt(){return this.set(Math.sqrt(this.vec[0]),Math.sqrt(this.vec[1]),Math.sqrt(this.vec[2]))}get rgb(){return this.set(u(this.vec[0]*256|0,0,255),u(this.vec[1]*256|0,0,255),u(this.vec[2]*256|0,0,255))}get x(){return this.vec[0]}get y(){return this.vec[1]}get z(){return this.vec[2]}}class Y{constructor(){n(this,"t",0);n(this,"frontFace",!1);n(this,"material");n(this,"point",new a);n(this,"normal",new a)}copy(t){this.frontFace=t.frontFace,this.normal.copy(t.normal),this.point.copy(t.point),this.t=t.t}setFaceNormal(t,e){this.frontFace=t.direction.dot(e)<0,this.normal.copy(this.frontFace?e:e.negate)}}var w=new Y;class C{}class Z extends C{constructor(e){super();n(this,"objects",[]);e&&this.add(e)}add(e){this.objects.push(e)}hit(e,s,i,o){let h=!1,c=i;for(let l=0,v=this.objects.length;l<v;l++)this.objects[l].hit(e,s,c,w)&&(c=w.t,o.copy(w),h=!0);return h}clear(){this.objects.length=0}}class b{}class _ extends b{constructor(e,s){super();n(this,"fuzz");n(this,"albedo");n(this,"direction",new a);this.albedo=e.clone,this.fuzz=Math.min(s,1)}scatter(e,s,i,o){const h=e.direction.unitVector.reflect(s.normal);return this.direction.randomUnitSphere.multiply(this.fuzz).add(h),i.direction=this.direction,i.origin=s.point,o.copy(this.albedo),this.direction.dot(s.normal)>0}}class y extends b{constructor(e){super();n(this,"albedo");n(this,"direction",new a);this.albedo=e.clone}scatter(e,s,i,o){const h=s.normal.add(this.direction.randomUnitVector);return h.nearZero&&h.copy(s.normal),i.direction=h,i.origin=s.point,o.copy(this.albedo),!0}}class F extends b{constructor(t){super(),this.refraction=t}reflectance(t,e){const s=Math.pow((1-e)/(1+e),2);return Math.pow(1-t,5)*(1-s)+s}scatter(t,e,s,i){const o=t.direction.unitVector,h=Math.min(o.clone.negate.dot(e.normal),1),c=e.frontFace?1/this.refraction:this.refraction;return Math.sqrt(1-h*h)*c>1||Math.random()<this.reflectance(h,c)?o.reflect(e.normal):o.refract(e.normal,c),s.direction=o,s.origin=e.point,i.reset(1),!0}}class K{constructor(){n(this,"hittables",new Z);n(this,"color",new a);this.addSphere(new a(0,-1e3,0),1e3,new y(new a(.5))),this.generateSmallSpheres(),this.addSphere(new a(0,1,0),1,new F(1.5)),this.addSphere(new a(-4,1,0),1,new y(new a(.4,.2,.1))),this.addSphere(new a(4,1,0),1,new _(new a(.7,.6,.5),0))}addSphere(t,e,s){this.hittables.add(new Q(t,e,s))}generateSmallSpheres(){for(let t=-11;t<11;t++)for(let e=-11;e<11;e++){const s=new a(Math.random()*.9+t,.2,Math.random()*.9+e),i=new a(4,.2,0);if(s.clone.sub(i).length>.9){const o=Math.random();if(o<.8){this.color.random().multiply(this.color.random());const h=new y(this.color);this.addSphere(s,.2,h)}else if(o<.95){this.color.random(.5);const h=x(0,.5),c=new _(this.color,h);this.addSphere(s,.2,c)}else{const h=new F(1.5);this.addSphere(s,.2,h)}}}}get objects(){return this.hittables}}class Q extends C{constructor(t,e,s){super(),this.center=t,this.radius=e,this.material=s}hit(t,e,s,i){const o=t.origin.clone.sub(this.center),h=t.direction.lengthSquared,c=o.dot(t.direction),l=o.lengthSquared-this.radius*this.radius,v=c*c-h*l;if(v<0)return!1;const p=Math.sqrt(v);let g=(-c-p)/h;if((g<e||g>s)&&(g=(-c+p)/h,g<e||g>s))return!1;i.t=g,i.point.copy(t.at(i.t));const M=i.point.clone.sub(this.center).divide(this.radius);return i.setFaceNormal(t,M),i.material=this.material,!0}}class J{constructor(t,e,s,i,o,h,c){n(this,"u");n(this,"v");n(this,"width");n(this,"height");n(this,"origin");n(this,"vertical");n(this,"lensRadius");n(this,"horizontal");n(this,"random",new a);n(this,"lowerLeftCorner");const l=t.clone.sub(e).unitVector,v=Math.tan(B(i)*.5);this.u=s.cross(l).unitVector,this.v=l.clone.cross(this.u),this.origin=t,this.height=v*2,this.width=o*this.height,this.lensRadius=h*.5,this.horizontal=this.u.clone.multiply(this.width).multiply(c),this.vertical=this.v.clone.multiply(this.height).multiply(c),this.lowerLeftCorner=this.origin.clone.sub(this.horizontal.clone.divide(2)).sub(this.vertical.clone.divide(2)).sub(l.multiply(c))}setRay(t,e,s){const i=this.random.randomUnitDisk.multiply(this.lensRadius),o=this.u.clone.multiply(i.x).add(this.v.clone.multiply(i.y));t.direction=this.lowerLeftCorner.clone.add(this.horizontal.clone.multiply(e)).add(this.vertical.clone.multiply(s)).sub(this.origin).sub(o),t.origin=o.add(this.origin)}}class T{constructor(t=new a,e=new a){n(this,"color",new a(1));n(this,"far",1/0);n(this,"near",.001);this.orig=t,this.dir=e}at(t){return this.orig.clone.add(this.dir.clone.multiply(t))}getColor(t,e,s){if(!s)return this.color.reset();if(e.hit(t,this.near,this.far,w)){const o=new a,h=new T;return w.material.scatter(t,w,h,o)?this.getColor(h,e,s-1).multiply(o):this.color.reset()}const i=(t.dir.unitVector.y+1)*.5;return this.color.reset(1).multiply(1-i).add(new a(.5,.7,1).multiply(i))}set direction(t){this.dir.copy(t)}get direction(){return this.dir}set origin(t){this.orig.copy(t)}get origin(){return this.orig}}class U{constructor(){n(this,"last",Date.now());n(this,"camera");n(this,"world",new K);n(this,"color",new a);n(this,"width",d.width);n(this,"height",d.height);n(this,"depth",d.maxDepth);n(this,"samples",d.samples);const t=this.width/this.height;this.camera=new J(new a(13,2,3),new a(0,0,0),new a(0,1,0),20,t,.1,10)}createPPMImage(t,e,s=this.samples){const i=new T,o=this.samples===s;for(let p=0,g=this.height-1,M=this.width-1,$=g;g>-1;g--){o&&console.info(`Progress: ${E((1-g/$)*100)}%`);for(let S=0;S<this.width;S++,p+=3){this.color.set(t[p],t[p+1],t[p+2]);const ct=(S+Math.random())/M,lt=(g+Math.random())/$;this.camera.setRay(i,ct,lt);const{x:dt,y:ut,z:gt}=this.color.add(i.getColor(i,this.world.objects,this.depth));t[p]=dt,t[p+1]=ut,t[p+2]=gt}}const h=Date.now(),c=`${o&&"Total "||""}Samples: ${s}`,l=`Total Time: ${E((h-e)/1e3)} sec.`,v=`Last Render Time: ${E((h-this.last)/1e3)} sec.`;console.info(`${c} | ${v} | ${l}`),this.last=h}}class tt extends CustomEvent{constructor(){super(...arguments);n(this,"data")}}class et{constructor(){n(this,"target",new EventTarget);n(this,"events",new Map);n(this,"callbacks",new Map)}add(t,e){const s=this.callbacks.get(t);s?s.push(e):this.callbacks.set(t,[e]),this.events.set(t,new tt(t)),this.target.addEventListener(t,e,!1)}dispatch(t,e){const s=this.events.get(t);s&&(s.data=e,this.target.dispatchEvent(s))}remove(t,e){const s=this.callbacks.get(t);if(s&&e){const i=s.indexOf(e),o=e;i!==-1&&s.splice(i,1),this.target.removeEventListener(t,o,!1)}e||(s==null||s.forEach(i=>this.target.removeEventListener(t,i,!1)),this.callbacks.delete(t),this.events.delete(t))}dispose(){this.callbacks.clear(),this.events.clear()}}class k{constructor(t){this.worker=t}add(t,e){this.worker.add(t,e)}static dispatch(t,e){at.postMessage({name:t,response:{data:e}})}remove(t){this.worker.remove(t)}dispose(){this.worker.dispose()}}class st extends et{constructor(){super(...arguments);n(this,"offscreen",!1);n(this,"workerEvents")}createWorkerEvents(e,s){this.workerEvents=new k(e),this.offscreen=s}add(e,s){var i;this.offscreen?(i=this.workerEvents)==null||i.add(e,s):super.add(e,s)}dispatch(e,s,i=!1){i?k.dispatch(e,s):super.dispatch(e,s)}remove(e,s){var i;this.offscreen?(i=this.workerEvents)==null||i.remove(e):super.remove(e,s)}dispose(){var e;(e=this.workerEvents)==null||e.dispose(),super.dispose()}}var it=new st;class rt{constructor(t){n(this,"sample",0);n(this,"canvas");n(this,"tracer");n(this,"worker");n(this,"start",Date.now());n(this,"color",new a);n(this,"samples",d.samples);n(this,"f32",new Float32Array(d.width*d.height*3));n(this,"uint8",new Uint8ClampedArray(d.width*d.height*3));this.canvas=this.createCanvas(t),(this.worker=t.worker)?this.createWorkerEvents():this.tracer=new U,this.canvas.clear(),this.createPPMImage()}createCanvas(t){switch(t.backEnd){case"webgl2":return new H(t);case"webgl":return new D(t);default:return new j(t)}}createWorkerEvents(){var t;(t=this.worker)==null||t.add("Create::PPMImage",this.showPPMImage.bind(this))}createPPMImage(t=!1){var e;if(this.worker)return this.worker.post("Create::PPMImage",{download:t});(e=this.tracer)==null||e.createPPMImage(this.f32,this.start,++this.sample),R(this.f32,this.uint8,this.color,this.sample),this.showPPMImage({pixels:this.uint8,sample:this.sample,download:t},!0)}showPPMImage(t,e){const s=t;this.canvas.drawImage(s.pixels),this.samples===s.sample||!(this.worker?s.sample:this.sample)?s.download&&this.downloadPPMImage(s.pixels,e):setTimeout(this.createPPMImage.bind(this,s.download),q)}downloadPPMImage(t,e){let s=`P3
${this.canvas.width} ${this.canvas.height}
255
`;for(let i=0;i<t.length;i+=3)s+=`${t[i]} ${t[i+1]} ${t[i+2]}
`;it.dispatch("Download::PPMImage",{image:s},e)}}let nt=0,P=0;const ot=new a,ht=new U,L=new Float32Array(d.width*d.height*3),z=new Uint8ClampedArray(d.width*d.height*3);self.onerror=r=>console.error(r),self.onmessage=r=>{const{event:t}=r.data;let{params:e}=r.data;switch(t){case"Transfer::Offscreen":return new rt({offscreen:!0,...e});case"Create::PPMImage":ht.createPPMImage(L,nt||(nt=Date.now()),++P),R(L,z,ot,P),e={sample:P,pixels:z,...e};break}self.postMessage({response:e,name:t})};var at=self})();
