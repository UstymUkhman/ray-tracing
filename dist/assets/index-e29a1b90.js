var mt=Object.defineProperty;var wt=(s,t,e)=>t in s?mt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var a=(s,t,e)=>(wt(s,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();let Z=et;const y=1,R=2,J={owned:null,cleanups:null,context:null,owner:null};var m=null;let k=null,w=null,g=null,v=null,D=0;function vt(s,t){const e=w,i=m,n=s.length===0,r=n?J:{owned:null,cleanups:null,context:null,owner:t===void 0?i:t},o=n?s:()=>s(()=>S(()=>_(r)));m=r,w=null;try{return U(o,!0)}finally{w=e,m=i}}function C(s,t,e){const i=tt(s,t,!1,y);W(i)}function xt(s,t,e){Z=St;const i=tt(s,t,!1,y);(!e||!e.render)&&(i.user=!0),v?v.push(i):W(i)}function S(s){if(w===null)return s();const t=w;w=null;try{return s()}finally{w=t}}function yt(s){xt(()=>S(s))}function Et(s,t,e){let i=s.value;return(!s.comparator||!s.comparator(i,t))&&(s.value=t,s.observers&&s.observers.length&&U(()=>{for(let n=0;n<s.observers.length;n+=1){const r=s.observers[n],o=k&&k.running;o&&k.disposed.has(r),(o?!r.tState:!r.state)&&(r.pure?g.push(r):v.push(r),r.observers&&st(r)),o||(r.state=y)}if(g.length>1e6)throw g=[],new Error},!1)),t}function W(s){if(!s.fn)return;_(s);const t=m,e=w,i=D;w=m=s,bt(s,s.value,i),w=e,m=t}function bt(s,t,e){let i;try{i=s.fn(t)}catch(n){return s.pure&&(s.state=y,s.owned&&s.owned.forEach(_),s.owned=null),s.updatedAt=e+1,it(n)}(!s.updatedAt||s.updatedAt<=e)&&(s.updatedAt!=null&&"observers"in s?Et(s,i):s.value=i,s.updatedAt=e)}function tt(s,t,e,i=y,n){const r={fn:s,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:m,context:null,pure:e};return m===null||m!==J&&(m.owned?m.owned.push(r):m.owned=[r]),r}function I(s){if(s.state===0)return;if(s.state===R)return O(s);if(s.suspense&&S(s.suspense.inFallback))return s.suspense.effects.push(s);const t=[s];for(;(s=s.owner)&&(!s.updatedAt||s.updatedAt<D);)s.state&&t.push(s);for(let e=t.length-1;e>=0;e--)if(s=t[e],s.state===y)W(s);else if(s.state===R){const i=g;g=null,U(()=>O(s,t[0]),!1),g=i}}function U(s,t){if(g)return s();let e=!1;t||(g=[]),v?e=!0:v=[],D++;try{const i=s();return Tt(e),i}catch(i){e||(v=null),g=null,it(i)}}function Tt(s){if(g&&(et(g),g=null),s)return;const t=v;v=null,t.length&&U(()=>Z(t),!1)}function et(s){for(let t=0;t<s.length;t++)I(s[t])}function St(s){let t,e=0;for(t=0;t<s.length;t++){const i=s[t];i.user?s[e++]=i:I(i)}for(t=0;t<e;t++)I(s[t])}function O(s,t){s.state=0;for(let e=0;e<s.sources.length;e+=1){const i=s.sources[e];if(i.sources){const n=i.state;n===y?i!==t&&(!i.updatedAt||i.updatedAt<D)&&I(i):n===R&&O(i,t)}}}function st(s){for(let t=0;t<s.observers.length;t+=1){const e=s.observers[t];e.state||(e.state=R,e.pure?g.push(e):v.push(e),e.observers&&st(e))}}function _(s){let t;if(s.sources)for(;s.sources.length;){const e=s.sources.pop(),i=s.sourceSlots.pop(),n=e.observers;if(n&&n.length){const r=n.pop(),o=e.observerSlots.pop();i<n.length&&(r.sourceSlots[o]=i,n[i]=r,e.observerSlots[i]=o)}}if(s.owned){for(t=s.owned.length-1;t>=0;t--)_(s.owned[t]);s.owned=null}if(s.cleanups){for(t=s.cleanups.length-1;t>=0;t--)s.cleanups[t]();s.cleanups=null}s.state=0,s.context=null}function it(s){throw s}function At(s,t){return S(()=>s(t||{}))}function Pt(s,t,e){let i=e.length,n=t.length,r=i,o=0,h=0,c=t[n-1].nextSibling,f=null;for(;o<n||h<r;){if(t[o]===e[h]){o++,h++;continue}for(;t[n-1]===e[r-1];)n--,r--;if(n===o){const u=r<i?h?e[h-1].nextSibling:e[r-h]:c;for(;h<r;)s.insertBefore(e[h++],u)}else if(r===h)for(;o<n;)(!f||!f.has(t[o]))&&t[o].remove(),o++;else if(t[o]===e[r-1]&&e[h]===t[n-1]){const u=t[--n].nextSibling;s.insertBefore(e[h++],t[o++].nextSibling),s.insertBefore(e[--r],u),t[n]=e[r]}else{if(!f){f=new Map;let d=h;for(;d<r;)f.set(e[d],d++)}const u=f.get(t[o]);if(u!=null)if(h<u&&u<r){let d=o,x=1,A;for(;++d<n&&d<r&&!((A=f.get(t[d]))==null||A!==u+x);)x++;if(x>u-h){const P=t[o];for(;h<u;)s.insertBefore(e[h++],P)}else s.replaceChild(e[h++],t[o++])}else o++;else t[o++].remove()}}}function Mt(s,t,e,i={}){let n;return vt(r=>{n=r,t===document?s():It(t,s(),t.firstChild?null:void 0,e)},i.owner),()=>{n(),t.textContent=""}}function Rt(s,t,e){let i;const n=()=>{const o=document.createElement("template");return o.innerHTML=s,e?o.content.firstChild.firstChild:o.content.firstChild},r=t?()=>(i||(i=n())).cloneNode(!0):()=>S(()=>document.importNode(i||(i=n()),!0));return r.cloneNode=r,r}function q(s,t,e){e==null?s.removeAttribute(t):s.setAttribute(t,e)}function Ct(s,t,e){return S(()=>s(t,e))}function It(s,t,e,i){if(e!==void 0&&!i&&(i=[]),typeof t!="function")return L(s,t,i,e);C(n=>L(s,t(),n,e),i)}function L(s,t,e,i,n){for(;typeof e=="function";)e=e();if(t===e)return e;const r=typeof t,o=i!==void 0;if(s=o&&e[0]&&e[0].parentNode||s,r==="string"||r==="number")if(r==="number"&&(t=t.toString()),o){let h=e[0];h&&h.nodeType===3?h.data=t:h=document.createTextNode(t),e=E(s,e,i,h)}else e!==""&&typeof e=="string"?e=s.firstChild.data=t:e=s.textContent=t;else if(t==null||r==="boolean")e=E(s,e,i);else{if(r==="function")return C(()=>{let h=t();for(;typeof h=="function";)h=h();e=L(s,h,e,i)}),()=>e;if(Array.isArray(t)){const h=[],c=e&&Array.isArray(e);if(N(h,t,e,n))return C(()=>e=L(s,h,e,i,!0)),()=>e;if(h.length===0){if(e=E(s,e,i),o)return e}else c?e.length===0?j(s,h,i):Pt(s,e,h):(e&&E(s),j(s,h));e=h}else if(t.nodeType){if(Array.isArray(e)){if(o)return e=E(s,e,i,t);E(s,e,null,t)}else e==null||e===""||!s.firstChild?s.appendChild(t):s.replaceChild(t,s.firstChild);e=t}else console.warn("Unrecognized value. Skipped inserting",t)}return e}function N(s,t,e,i){let n=!1;for(let r=0,o=t.length;r<o;r++){let h=t[r],c=e&&e[r],f;if(!(h==null||h===!0||h===!1))if((f=typeof h)=="object"&&h.nodeType)s.push(h);else if(Array.isArray(h))n=N(s,h,c)||n;else if(f==="function")if(i){for(;typeof h=="function";)h=h();n=N(s,Array.isArray(h)?h:[h],Array.isArray(c)?c:[c])||n}else s.push(h),n=!0;else{const u=String(h);c&&c.nodeType===3&&c.data===u?s.push(c):s.push(document.createTextNode(u))}}return n}function j(s,t,e=null){for(let i=0,n=t.length;i<n;i++)s.insertBefore(t[i],e)}function E(s,t,e,i){if(e===void 0)return s.textContent="";const n=i||document.createTextNode("");if(t.length){let r=!1;for(let o=t.length-1;o>=0;o--){const h=t[o];if(n!==h){const c=h.parentNode===s;!r&&!o?c?s.replaceChild(n,h):s.insertBefore(n,e):c&&h.remove()}else r=!0}}else s.insertBefore(n,e);return[n]}const p={backEnd:"webgl2",pixelRatio:1,maxDepth:50,samples:500,height:240,width:360};function Lt(){return new Worker(""+new URL("worker-17dcdf32.js",import.meta.url).href)}let Dt=class{constructor(){a(this,"events",new Map);a(this,"worker",new Lt);this.worker.onmessage=this.onMessage.bind(this),this.worker.onerror=this.onError.bind(this)}add(t,e,i){this.events.set(t,{callback:e,params:i})}transfer(t,e){this.worker.postMessage({event:"Transfer::Offscreen",params:{canvas:t,...e}},[t])}post(t,e){var n;const i=(n=this.events.get(t))==null?void 0:n.params;this.worker.postMessage({event:t,params:{...i,...e}})}onMessage(t){var n,r,o;const{name:e,response:i}=t.data;(o=(r=(n=this.events)==null?void 0:n.get(e))==null?void 0:r.callback)==null||o.call(r,i)}onError(t){console.error(t)}remove(t){this.events.delete(t)}dispose(){this.events.clear()}};class Ut{downloadImage(t,e="image"){const i=document.createElement("a");i.href=URL.createObjectURL(new Blob([t],{type:"text/plain; charset=UTF-8"})),i.download=`${e}.ppm`,i.click(),URL.revokeObjectURL(i.href)}}const _t=`#version 300 es

precision mediump float;

uniform vec2 resolution;

in  vec2 position;
in  vec2 coords;
out vec2 uv;

void main (void)
{
  gl_Position = vec4((
    position / resolution * 2.0 - 1.0
  ) * vec2(1.0, -1.0), 0.0, 1.0);

  uv = coords;
}
`,kt=`#version 300 es

#ifndef GL_FRAGMENT_PRECISION_HIGH
  precision mediump float;
#else
  precision highp float;
#endif

uniform sampler2D tex;

in  vec2 uv;
out vec4 fragColor;

void main (void)
{
  fragColor = texture(tex, uv);
}
`,b=(s,t=0,e=1)=>Math.max(t,Math.min(s,e)),M=(s,t)=>Math.random()*(t-s)+s,Ft=s=>s*Math.PI/180,F=(s,t=2)=>{const e=Math.pow(10,t);return~~(e*s)/e},$t=1/.06,nt=(s,t,e,i)=>{for(let n=0;n<s.length;n+=3){e.set(s[n],s[n+1],s[n+2]);const{x:r,y:o,z:h}=Nt(e,i);t[n]=r,t[n+1]=o,t[n+2]=h}},Bt=(s,t=1)=>(s=typeof s=="string"?Ot(s):s,{r:s>>16&t,g:s>>8&t,b:s&t}),rt=s=>(s=typeof s=="number"?s:zt(s),`#${`000000${s.toString(16)}`.slice(-6)}`),Ot=s=>(s=typeof s=="string"?s:rt(s),parseInt(s.slice(1),16)),Nt=(s,t)=>s.divide(t).sqrt.rgb,zt=({r:s,g:t,b:e})=>b(s*255,0,255)<<16^b(t*255,0,255)<<8^b(e*255,0,255)<<0;class ot{constructor(t,e){a(this,"context");a(this,"backEnd");a(this,"clearColor",0);a(this,"channels");a(this,"height");a(this,"width");a(this,"side");this.backEnd=e;const i=e==="2d",{canvas:n,offscreen:r}=t;this.context=n.getContext(e,this.getOptions(e,r)),this.width=n.width,this.height=n.height,this.channels=+i+3,this.side=this.width*this.channels}getOptions(t,e=!1){switch(t){case"2d":return{willReadFrequently:!e,desynchronized:e,colorSpace:"srgb",alpha:!1};case"webgpu":return{};default:return{powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!1,desynchronized:!e,premultipliedAlpha:!1,antialias:!0,stencil:!1,depth:!1,alpha:!1}}}getPixel(t,e){return e*this.side+t*this.channels}}const Wt=`precision mediump float;

uniform vec2 resolution;

attribute vec2 position;
attribute vec2 coords;
varying   vec2 uv;

void main (void)
{
  gl_Position = vec4((
    position / resolution * 2.0 - 1.0
  ) * vec2(1.0, -1.0), 0.0, 1.0);

  uv = coords;
}
`,Gt=`#ifndef GL_FRAGMENT_PRECISION_HIGH
  precision mediump float;
#else
  precision highp float;
#endif

uniform sampler2D tex;

varying vec2 uv;

void main (void)
{
  gl_FragColor = texture2D(tex, uv);
}
`;class ht extends ot{constructor(e,i="webgl",n=Gt,r=Wt){super(e,i);a(this,"textureData",new Uint8ClampedArray(this.width*this.height*this.channels));a(this,"texture");a(this,"program");this.createProgram(n,r),this.createScene()}loadShader(e,i){const n=this.context.createShader(i);return this.context.shaderSource(n,e),this.context.compileShader(n),this.context.getShaderParameter(n,this.context.COMPILE_STATUS)?n:(console.error(`An error occurred compiling the shaders: ${this.context.getShaderInfoLog(n)}`),this.context.deleteShader(n))}setBufferData(e=this.width,i=this.height){this.context.bufferData(this.context.ARRAY_BUFFER,new Float32Array([0,0,e,0,0,i,0,i,e,0,e,i]),this.context.STATIC_DRAW)}createProgram(e,i){const n=this.loadShader(e,this.context.FRAGMENT_SHADER),r=this.loadShader(i,this.context.VERTEX_SHADER);if(this.program=this.context.createProgram(),r&&n&&(this.context.attachShader(this.program,n),this.context.attachShader(this.program,r),this.context.linkProgram(this.program)),!this.context.getProgramParameter(this.program,this.context.LINK_STATUS))return console.error(`Unable to initialize shader program: ${this.context.getProgramInfoLog(this.program)}`);this.context.clear(this.context.COLOR_BUFFER_BIT);const{r:o,g:h,b:c}=Bt(this.clearColor,1);this.context.clearColor(o,h,c,1),this.context.useProgram(this.program)}updateTexture(){this.context.activeTexture(this.context.TEXTURE0),this.context.bindTexture(this.context.TEXTURE_2D,this.texture),this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGB,this.width,this.height,0,this.context.RGB,this.context.UNSIGNED_BYTE,this.textureData)}createScene(){const e=this.context.getAttribLocation(this.program,"coords");this.context.bindBuffer(this.context.ARRAY_BUFFER,this.context.createBuffer()),this.setBufferData(1,1),this.context.enableVertexAttribArray(e),this.context.vertexAttribPointer(e,2,this.context.FLOAT,!1,0,0);const i=this.context.getAttribLocation(this.program,"position");this.context.bindBuffer(this.context.ARRAY_BUFFER,this.context.createBuffer()),this.setBufferData(),this.context.enableVertexAttribArray(i),this.context.vertexAttribPointer(i,2,this.context.FLOAT,!1,0,0);const n=this.context.getUniformLocation(this.program,"resolution");this.context.uniform2f(n,this.width,this.height),this.texture=this.context.createTexture(),this.setBufferData(),this.updateTexture(),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.NEAREST),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MAG_FILTER,this.context.NEAREST)}drawImage(e){this.textureData=e,this.updateTexture(),this.context.drawArrays(this.context.TRIANGLES,0,6)}clear(){this.context.clear(this.context.COLOR_BUFFER_BIT)}}class Vt extends ht{constructor(t){super(t,"webgl2",kt,_t)}}class qt extends ot{constructor(e){super(e,"2d");a(this,"image");this.context.imageSmoothingEnabled=!0,this.context.imageSmoothingQuality="high",this.image=this.context.getImageData(0,0,this.width,this.height)}drawImage(e){for(let i=0,n=0;i<e.length;i+=3,n+=4)this.image.data[n]=e[i],this.image.data[n+1]=e[i+1],this.image.data[n+2]=e[i+2],this.image.data[n+3]=255;this.context.putImageData(this.image,0,0)}clear(){this.context.fillStyle=rt(this.clearColor),this.context.clearRect(0,0,this.width,this.height),this.context.fillRect(0,0,this.width,this.height)}}class l{constructor(t=0,e,i){a(this,"vec",[0,0,0]);this.vec[0]=t,this.vec[1]=e??t,this.vec[2]=i??t}multiply(t){if(typeof t!="number")return this.set(this.vec[0]*t.x,this.vec[1]*t.y,this.vec[2]*t.z);const e=t;return this.vec[0]*=e,this.vec[1]*=e,this.vec[2]*=e,this}divide(t){return typeof t=="number"?this.multiply(1/t):this.set(this.vec[0]/t.x,this.vec[1]/t.y,this.vec[2]/t.z)}get(t){return t===void 0?this.vec:this.vec[t]}refract(t,e){const i=Math.min(this.clone.negate.dot(t),1);this.copy(t.clone.multiply(i).add(this).multiply(e));const n=Math.abs(1-this.lengthSquared);return this.add(t.multiply(-Math.sqrt(n)))}set(t,e,i){return this.vec[0]=t,this.vec[1]=e,this.vec[2]=i,this}randomHemisphere(t){return this.randomUnitSphere,this.dot(t)>0?this:this.negate}random(t=0,e=1){return this.set(M(t,e),M(t,e),M(t,e))}reflect(t){return this.sub(t.clone.multiply(this.dot(t)*2))}get randomUnitVector(){return this.randomUnitSphere.unitVector}get randomUnitSphere(){for(;;)if(this.random(-1).lengthSquared<1)return this}get lengthSquared(){return this.dot(this)}get randomUnitDisk(){for(;;)if(this.random(-1),this.vec[2]=0,this.lengthSquared<1)return this}cross(t){return this.set(this.vec[1]*t.z-this.vec[2]*t.y,this.vec[2]*t.x-this.vec[0]*t.z,this.vec[0]*t.y-this.vec[1]*t.x)}dot(t){return this.vec[0]*t.x+this.vec[1]*t.y+this.vec[2]*t.z}copy(t){const{x:e,y:i,z:n}=t;return this.set(e,i,n)}add(t){return this.vec[0]+=t.x,this.vec[1]+=t.y,this.vec[2]+=t.z,this}sub(t){return this.vec[0]-=t.x,this.vec[1]-=t.y,this.vec[2]-=t.z,this}get nearZero(){return Math.abs(this.vec[0])<1e-8&&Math.abs(this.vec[1])<1e-8&&Math.abs(this.vec[2])<1e-8}get unitVector(){return this.divide(this.length)}get length(){return Math.sqrt(this.lengthSquared)}get clone(){return new l(this.vec[0],this.vec[1],this.vec[2])}reset(t=0){return this.set(t,t,t)}get print(){const[t,e,i]=this.vec;return`Vector3 { x: ${t}, y: ${e}, z: ${i} }`}get negate(){return this.vec[0]*=-1,this.vec[1]*=-1,this.vec[2]*=-1,this}get sqrt(){return this.set(Math.sqrt(this.vec[0]),Math.sqrt(this.vec[1]),Math.sqrt(this.vec[2]))}get rgb(){return this.set(b(this.vec[0]*256|0,0,255),b(this.vec[1]*256|0,0,255),b(this.vec[2]*256|0,0,255))}get x(){return this.vec[0]}get y(){return this.vec[1]}get z(){return this.vec[2]}}class jt{constructor(){a(this,"t",0);a(this,"frontFace",!1);a(this,"material");a(this,"point",new l);a(this,"normal",new l)}copy(t){this.frontFace=t.frontFace,this.normal.copy(t.normal),this.point.copy(t.point),this.t=t.t}setFaceNormal(t,e){this.frontFace=t.direction.dot(e)<0,this.normal.copy(this.frontFace?e:e.negate)}}const T=new jt;class at{}class Ht extends at{constructor(e){super();a(this,"objects",[]);e&&this.add(e)}add(e){this.objects.push(e)}hit(e,i,n,r){let o=!1,h=n;for(let c=0,f=this.objects.length;c<f;c++)this.objects[c].hit(e,i,h,T)&&(h=T.t,r.copy(T),o=!0);return o}clear(){this.objects.length=0}}class G{}class H extends G{constructor(e,i){super();a(this,"fuzz");a(this,"albedo");a(this,"direction",new l);this.albedo=e.clone,this.fuzz=Math.min(i,1)}scatter(e,i,n,r){const o=e.direction.unitVector.reflect(i.normal);return this.direction.randomUnitSphere.multiply(this.fuzz).add(o),n.direction=this.direction,n.origin=i.point,r.copy(this.albedo),this.direction.dot(i.normal)>0}}class $ extends G{constructor(e){super();a(this,"albedo");a(this,"direction",new l);this.albedo=e.clone}scatter(e,i,n,r){const o=i.normal.add(this.direction.randomUnitVector);return o.nearZero&&o.copy(i.normal),n.direction=o,n.origin=i.point,r.copy(this.albedo),!0}}class X extends G{constructor(t){super(),this.refraction=t}reflectance(t,e){const i=Math.pow((1-e)/(1+e),2);return Math.pow(1-t,5)*(1-i)+i}scatter(t,e,i,n){const r=t.direction.unitVector,o=Math.min(r.clone.negate.dot(e.normal),1),h=e.frontFace?1/this.refraction:this.refraction;return Math.sqrt(1-o*o)*h>1||Math.random()<this.reflectance(o,h)?r.reflect(e.normal):r.refract(e.normal,h),i.direction=r,i.origin=e.point,n.reset(1),!0}}class Xt{constructor(){a(this,"hittables",new Ht);a(this,"color",new l);this.addSphere(new l(0,-1e3,0),1e3,new $(new l(.5))),this.generateSmallSpheres(),this.addSphere(new l(0,1,0),1,new X(1.5)),this.addSphere(new l(-4,1,0),1,new $(new l(.4,.2,.1))),this.addSphere(new l(4,1,0),1,new H(new l(.7,.6,.5),0))}addSphere(t,e,i){this.hittables.add(new Yt(t,e,i))}generateSmallSpheres(){for(let t=-11;t<11;t++)for(let e=-11;e<11;e++){const i=new l(Math.random()*.9+t,.2,Math.random()*.9+e),n=new l(4,.2,0);if(i.clone.sub(n).length>.9){const r=Math.random();if(r<.8){this.color.random().multiply(this.color.random());const o=new $(this.color);this.addSphere(i,.2,o)}else if(r<.95){this.color.random(.5);const o=M(0,.5),h=new H(this.color,o);this.addSphere(i,.2,h)}else{const o=new X(1.5);this.addSphere(i,.2,o)}}}}get objects(){return this.hittables}}class Yt extends at{constructor(t,e,i){super(),this.center=t,this.radius=e,this.material=i}hit(t,e,i,n){const r=t.origin.clone.sub(this.center),o=t.direction.lengthSquared,h=r.dot(t.direction),c=r.lengthSquared-this.radius*this.radius,f=h*h-o*c;if(f<0)return!1;const u=Math.sqrt(f);let d=(-h-u)/o;if((d<e||d>i)&&(d=(-h+u)/o,d<e||d>i))return!1;n.t=d,n.point.copy(t.at(n.t));const x=n.point.clone.sub(this.center).divide(this.radius);return n.setFaceNormal(t,x),n.material=this.material,!0}}class Kt{constructor(t,e,i,n,r,o,h){a(this,"u");a(this,"v");a(this,"width");a(this,"height");a(this,"origin");a(this,"vertical");a(this,"lensRadius");a(this,"horizontal");a(this,"random",new l);a(this,"lowerLeftCorner");const c=t.clone.sub(e).unitVector,f=Math.tan(Ft(n)*.5);this.u=i.cross(c).unitVector,this.v=c.clone.cross(this.u),this.origin=t,this.height=f*2,this.width=r*this.height,this.lensRadius=o*.5,this.horizontal=this.u.clone.multiply(this.width).multiply(h),this.vertical=this.v.clone.multiply(this.height).multiply(h),this.lowerLeftCorner=this.origin.clone.sub(this.horizontal.clone.divide(2)).sub(this.vertical.clone.divide(2)).sub(c.multiply(h))}setRay(t,e,i){const n=this.random.randomUnitDisk.multiply(this.lensRadius),r=this.u.clone.multiply(n.x).add(this.v.clone.multiply(n.y));t.direction=this.lowerLeftCorner.clone.add(this.horizontal.clone.multiply(e)).add(this.vertical.clone.multiply(i)).sub(this.origin).sub(r),t.origin=r.add(this.origin)}}class V{constructor(t=new l,e=new l){a(this,"color",new l(1));a(this,"far",1/0);a(this,"near",.001);this.orig=t,this.dir=e}at(t){return this.orig.clone.add(this.dir.clone.multiply(t))}getColor(t,e,i){if(!i)return this.color.reset();if(e.hit(t,this.near,this.far,T)){const r=new l,o=new V;return T.material.scatter(t,T,o,r)?this.getColor(o,e,i-1).multiply(r):this.color.reset()}const n=(t.dir.unitVector.y+1)*.5;return this.color.reset(1).multiply(1-n).add(new l(.5,.7,1).multiply(n))}set direction(t){this.dir.copy(t)}get direction(){return this.dir}set origin(t){this.orig.copy(t)}get origin(){return this.orig}}class ct{constructor(){a(this,"last",Date.now());a(this,"camera");a(this,"world",new Xt);a(this,"color",new l);a(this,"width",p.width);a(this,"height",p.height);a(this,"depth",p.maxDepth);a(this,"samples",p.samples);const t=this.width/this.height;this.camera=new Kt(new l(13,2,3),new l(0,0,0),new l(0,1,0),20,t,.1,10)}createPPMImage(t,e,i=this.samples){const n=new V,r=this.samples===i;for(let u=0,d=this.height-1,x=this.width-1,A=d;d>-1;d--){r&&console.info(`Progress: ${F((1-d/A)*100)}%`);for(let P=0;P<this.width;P++,u+=3){this.color.set(t[u],t[u+1],t[u+2]);const ut=(P+Math.random())/x,dt=(d+Math.random())/A;this.camera.setRay(n,ut,dt);const{x:ft,y:pt,z:gt}=this.color.add(n.getColor(n,this.world.objects,this.depth));t[u]=ft,t[u+1]=pt,t[u+2]=gt}}const o=Date.now(),h=`${r&&"Total "||""}Samples: ${i}`,c=`Total Time: ${F((o-e)/1e3)} sec.`,f=`Last Render Time: ${F((o-this.last)/1e3)} sec.`;console.info(`${h} | ${f} | ${c}`),this.last=o}}class lt{constructor(t){a(this,"sample",0);a(this,"canvas");a(this,"tracer");a(this,"worker");a(this,"start",Date.now());a(this,"color",new l);a(this,"samples",p.samples);a(this,"f32",new Float32Array(p.width*p.height*3));a(this,"uint8",new Uint8ClampedArray(p.width*p.height*3));this.canvas=this.createCanvas(t),(this.worker=t.worker)?this.createWorkerEvents():this.tracer=new ct,this.canvas.clear(),this.createPPMImage()}createCanvas(t){switch(t.backEnd){case"webgl2":return new Vt(t);case"webgl":return new ht(t);default:return new qt(t)}}createWorkerEvents(){var t;(t=this.worker)==null||t.add("Create::PPMImage",this.showPPMImage.bind(this))}createPPMImage(t=!1){var e;if(this.worker)return this.worker.post("Create::PPMImage",{download:t});(e=this.tracer)==null||e.createPPMImage(this.f32,this.start,++this.sample),nt(this.f32,this.uint8,this.color,this.sample),this.showPPMImage({pixels:this.uint8,sample:this.sample,download:t},!0)}showPPMImage(t,e){const i=t;this.canvas.drawImage(i.pixels),this.samples===i.sample||!(this.worker?i.sample:this.sample)?i.download&&this.downloadPPMImage(i.pixels,e):setTimeout(this.createPPMImage.bind(this,i.download),$t)}downloadPPMImage(t,e){let i=`P3
${this.canvas.width} ${this.canvas.height}
255
`;for(let n=0;n<t.length;n+=3)i+=`${t[n]} ${t[n+1]} ${t[n+2]}
`;z.dispatch("Download::PPMImage",{image:i},e)}}let Qt=0,B=0;const Zt=new l,Jt=new ct,Y=new Float32Array(p.width*p.height*3),K=new Uint8ClampedArray(p.width*p.height*3);self.onerror=s=>console.error(s);self.onmessage=s=>{const{event:t}=s.data;let{params:e}=s.data;switch(t){case"Transfer::Offscreen":return new lt({offscreen:!0,...e});case"Create::PPMImage":Jt.createPPMImage(Y,Qt||(Qt=Date.now()),++B),nt(Y,K,Zt,B),e={sample:B,pixels:K,...e};break}self.postMessage({response:e,name:t})};const te=self;class ee extends CustomEvent{constructor(){super(...arguments);a(this,"data")}}class se{constructor(){a(this,"target",new EventTarget);a(this,"events",new Map);a(this,"callbacks",new Map)}add(t,e){const i=this.callbacks.get(t);i?i.push(e):this.callbacks.set(t,[e]),this.events.set(t,new ee(t)),this.target.addEventListener(t,e,!1)}dispatch(t,e){const i=this.events.get(t);i&&(i.data=e,this.target.dispatchEvent(i))}remove(t,e){const i=this.callbacks.get(t);if(i&&e){const n=i.indexOf(e),r=e;n!==-1&&i.splice(n,1),this.target.removeEventListener(t,r,!1)}e||(i==null||i.forEach(n=>this.target.removeEventListener(t,n,!1)),this.callbacks.delete(t),this.events.delete(t))}dispose(){this.callbacks.clear(),this.events.clear()}}class Q{constructor(t){this.worker=t}add(t,e){this.worker.add(t,e)}static dispatch(t,e){te.postMessage({name:t,response:{data:e}})}remove(t){this.worker.remove(t)}dispose(){this.worker.dispose()}}class ie extends se{constructor(){super(...arguments);a(this,"offscreen",!1);a(this,"workerEvents")}createWorkerEvents(e,i){this.workerEvents=new Q(e),this.offscreen=i}add(e,i){var n;this.offscreen?(n=this.workerEvents)==null||n.add(e,i):super.add(e,i)}dispatch(e,i,n=!1){n?Q.dispatch(e,i):super.dispatch(e,i)}remove(e,i){var n;this.offscreen?(n=this.workerEvents)==null||n.remove(e):super.remove(e,i)}dispose(){var e;(e=this.workerEvents)==null||e.dispose(),super.dispose()}}const z=new ie;class ne{constructor(t){a(this,"client",new Ut);a(this,"worker",new Dt);a(this,"offscreen",typeof HTMLCanvasElement<"u"&&!!HTMLCanvasElement.prototype.transferControlToOffscreen);z.createWorkerEvents(this.worker,this.offscreen);const{backEnd:e,pixelRatio:i=devicePixelRatio}=p;z.add("Download::PPMImage",this.downloadPPMImage.bind(this)),this.offscreen?this.worker.transfer(t.transferControlToOffscreen(),{backEnd:e,pixelRatio:i}):new lt({canvas:t,worker:this.worker,backEnd:e,pixelRatio:i})}downloadPPMImage(t){const{image:e}=t.data;this.client.downloadImage(e)}}const re=Rt("<canvas>"),oe=()=>{let s;return yt(()=>new ne(s)),(()=>{const t=re(),e=s;return typeof e=="function"?Ct(e,t):s=t,C(i=>{const n=p.height,r=p.width;return n!==i._v$&&q(t,"height",i._v$=n),r!==i._v$2&&q(t,"width",i._v$2=r),i},{_v$:void 0,_v$2:void 0}),t})()};Mt(()=>At(oe,{}),document.getElementById("root"));
