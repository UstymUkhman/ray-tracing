var Z=Object.defineProperty;var tt=(s,t,e)=>t in s?Z(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var h=(s,t,e)=>(tt(s,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();const et=Symbol("solid-dev-component");let W=G;const E=1,T=2,st={owned:null,cleanups:null,context:null,owner:null};var p=null;let M=null,m=null,g=null,v=null,C=0;function it(s,t){const e=m,i=p,n=s.length===0,r=n?{owned:null,cleanups:null,context:null,owner:null}:{owned:null,cleanups:null,context:null,owner:t===void 0?i:t},c=n?()=>s(()=>{throw new Error("Dispose method must be an explicit argument to createRoot function")}):()=>s(()=>y(()=>L(r)));p=r,m=null;try{return k(c,!0)}finally{m=e,p=i}}function P(s,t,e){const i=$(s,t,!1,E,e);I(i)}function nt(s,t,e){W=lt;const i=$(s,t,!1,E,e);(!e||!e.render)&&(i.user=!0),v?v.push(i):I(i)}function y(s){if(m===null)return s();const t=m;m=null;try{return s()}finally{m=t}}function rt(s){nt(()=>y(s))}function ot(s,t){const e=$(()=>y(()=>(Object.assign(s,{[et]:!0}),s(t))),void 0,!0,0);return e.props=t,e.observers=null,e.observerSlots=null,e.name=s.name,e.component=s,I(e),e.tValue!==void 0?e.tValue:e.value}function ct(s,t,e){let i=s.value;return(!s.comparator||!s.comparator(i,t))&&(s.value=t,s.observers&&s.observers.length&&k(()=>{for(let n=0;n<s.observers.length;n+=1){const r=s.observers[n],c=M&&M.running;c&&M.disposed.has(r),(c?!r.tState:!r.state)&&(r.pure?g.push(r):v.push(r),r.observers&&V(r)),c||(r.state=E)}if(g.length>1e6){throw g=[],new Error("Potential Infinite Loop Detected.");throw new Error}},!1)),t}function I(s){if(!s.fn)return;L(s);const t=p,e=m,i=C;m=p=s,ht(s,s.value,i),m=e,p=t}function ht(s,t,e){let i;try{i=s.fn(t)}catch(n){return s.pure&&(s.state=E,s.owned&&s.owned.forEach(L),s.owned=null),s.updatedAt=e+1,X(n)}(!s.updatedAt||s.updatedAt<=e)&&(s.updatedAt!=null&&"observers"in s?ct(s,i):s.value=i,s.updatedAt=e)}function $(s,t,e,i=E,n){const r={fn:s,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:p,context:null,pure:e};return p===null?console.warn("computations created outside a `createRoot` or `render` will never be disposed"):p!==st&&(p.owned?p.owned.push(r):p.owned=[r]),n&&n.name&&(r.name=n.name),r}function A(s){if(s.state===0)return;if(s.state===T)return D(s);if(s.suspense&&y(s.suspense.inFallback))return s.suspense.effects.push(s);const t=[s];for(;(s=s.owner)&&(!s.updatedAt||s.updatedAt<C);)s.state&&t.push(s);for(let e=t.length-1;e>=0;e--)if(s=t[e],s.state===E)I(s);else if(s.state===T){const i=g;g=null,k(()=>D(s,t[0]),!1),g=i}}function k(s,t){if(g)return s();let e=!1;t||(g=[]),v?e=!0:v=[],C++;try{const i=s();return at(e),i}catch(i){e||(v=null),g=null,X(i)}}function at(s){if(g&&(G(g),g=null),s)return;const t=v;v=null,t.length&&k(()=>W(t),!1)}function G(s){for(let t=0;t<s.length;t++)A(s[t])}function lt(s){let t,e=0;for(t=0;t<s.length;t++){const i=s[t];i.user?s[e++]=i:A(i)}for(t=0;t<e;t++)A(s[t])}function D(s,t){s.state=0;for(let e=0;e<s.sources.length;e+=1){const i=s.sources[e];if(i.sources){const n=i.state;n===E?i!==t&&(!i.updatedAt||i.updatedAt<C)&&A(i):n===T&&D(i,t)}}}function V(s){for(let t=0;t<s.observers.length;t+=1){const e=s.observers[t];e.state||(e.state=T,e.pure?g.push(e):v.push(e),e.observers&&V(e))}}function L(s){let t;if(s.sources)for(;s.sources.length;){const e=s.sources.pop(),i=s.sourceSlots.pop(),n=e.observers;if(n&&n.length){const r=n.pop(),c=e.observerSlots.pop();i<n.length&&(r.sourceSlots[c]=i,n[i]=r,e.observerSlots[i]=c)}}if(s.owned){for(t=s.owned.length-1;t>=0;t--)L(s.owned[t]);s.owned=null}if(s.cleanups){for(t=s.cleanups.length-1;t>=0;t--)s.cleanups[t]();s.cleanups=null}s.state=0,s.context=null,delete s.sourceMap}function X(s){throw s}function ut(s,t){return ot(s,t||{})}globalThis&&(globalThis.Solid$$?console.warn("You appear to have multiple instances of Solid. This can lead to unexpected behavior."):globalThis.Solid$$=!0);function ft(s,t,e){let i=e.length,n=t.length,r=i,c=0,o=0,a=t[n-1].nextSibling,l=null;for(;c<n||o<r;){if(t[c]===e[o]){c++,o++;continue}for(;t[n-1]===e[r-1];)n--,r--;if(n===c){const f=r<i?o?e[o-1].nextSibling:e[r-o]:a;for(;o<r;)s.insertBefore(e[o++],f)}else if(r===o)for(;c<n;)(!l||!l.has(t[c]))&&t[c].remove(),c++;else if(t[c]===e[r-1]&&e[o]===t[n-1]){const f=t[--n].nextSibling;s.insertBefore(e[o++],t[c++].nextSibling),s.insertBefore(e[--r],f),t[n]=e[r]}else{if(!l){l=new Map;let u=o;for(;u<r;)l.set(e[u],u++)}const f=l.get(t[c]);if(f!=null)if(o<f&&f<r){let u=c,x=1,O;for(;++u<n&&u<r&&!((O=l.get(t[u]))==null||O!==f+x);)x++;if(x>f-o){const J=t[c];for(;o<f;)s.insertBefore(e[o++],J)}else s.replaceChild(e[o++],t[c++])}else c++;else t[c++].remove()}}}function dt(s,t,e,i={}){let n;return it(r=>{n=r,t===document?s():wt(t,s(),t.firstChild?null:void 0,e)},i.owner),()=>{n(),t.textContent=""}}function gt(s,t,e){let i;const n=()=>{const c=document.createElement("template");return c.innerHTML=s,e?c.content.firstChild.firstChild:c.content.firstChild},r=t?()=>(i||(i=n())).cloneNode(!0):()=>y(()=>document.importNode(i||(i=n()),!0));return r.cloneNode=r,r}function B(s,t,e){e==null?s.removeAttribute(t):s.setAttribute(t,e)}function pt(s,t,e){return y(()=>s(t,e))}function wt(s,t,e,i){if(e!==void 0&&!i&&(i=[]),typeof t!="function")return R(s,t,i,e);P(n=>R(s,t(),n,e),i)}function R(s,t,e,i,n){for(;typeof e=="function";)e=e();if(t===e)return e;const r=typeof t,c=i!==void 0;if(s=c&&e[0]&&e[0].parentNode||s,r==="string"||r==="number")if(r==="number"&&(t=t.toString()),c){let o=e[0];o&&o.nodeType===3?o.data=t:o=document.createTextNode(t),e=b(s,e,i,o)}else e!==""&&typeof e=="string"?e=s.firstChild.data=t:e=s.textContent=t;else if(t==null||r==="boolean")e=b(s,e,i);else{if(r==="function")return P(()=>{let o=t();for(;typeof o=="function";)o=o();e=R(s,o,e,i)}),()=>e;if(Array.isArray(t)){const o=[],a=e&&Array.isArray(e);if(U(o,t,e,n))return P(()=>e=R(s,o,e,i,!0)),()=>e;if(o.length===0){if(e=b(s,e,i),c)return e}else a?e.length===0?N(s,o,i):ft(s,e,o):(e&&b(s),N(s,o));e=o}else if(t instanceof Node){if(Array.isArray(e)){if(c)return e=b(s,e,i,t);b(s,e,null,t)}else e==null||e===""||!s.firstChild?s.appendChild(t):s.replaceChild(t,s.firstChild);e=t}else console.warn("Unrecognized value. Skipped inserting",t)}return e}function U(s,t,e,i){let n=!1;for(let r=0,c=t.length;r<c;r++){let o=t[r],a=e&&e[r];if(o instanceof Node)s.push(o);else if(!(o==null||o===!0||o===!1))if(Array.isArray(o))n=U(s,o,a)||n;else if(typeof o=="function")if(i){for(;typeof o=="function";)o=o();n=U(s,Array.isArray(o)?o:[o],Array.isArray(a)?a:[a])||n}else s.push(o),n=!0;else{const l=String(o);a&&a.nodeType===3?(a.data=l,s.push(a)):s.push(document.createTextNode(l))}}return n}function N(s,t,e=null){for(let i=0,n=t.length;i<n;i++)s.insertBefore(t[i],e)}function b(s,t,e,i){if(e===void 0)return s.textContent="";const n=i||document.createTextNode("");if(t.length){let r=!1;for(let c=t.length-1;c>=0;c--){const o=t[c];if(n!==o){const a=o.parentNode===s;!r&&!c?a?s.replaceChild(n,o):s.insertBefore(n,e):a&&o.remove()}else r=!0}}else s.insertBefore(n,e);return[n]}var w;(s=>{s.Scene={pixelRatio:1,backEnd:"2d",height:225,width:400}})(w||(w={}));function mt(){return new Worker(""+new URL("worker-48ae4c53.js",import.meta.url).href)}let vt=class{constructor(){h(this,"events",new Map);h(this,"worker",new mt);this.worker.onmessage=this.onMessage.bind(this),this.worker.onerror=this.onError.bind(this)}add(t,e,i){this.events.set(t,{callback:e,params:i})}transfer(t,e){this.worker.postMessage({event:"Transfer::Offscreen",params:{canvas:t,...e}},[t])}post(t,e){var n;const i=(n=this.events.get(t))==null?void 0:n.params;this.worker.postMessage({event:t,params:{...i,...e}})}onMessage(t){var n,r,c;const{name:e,response:i}=t.data;(c=(r=(n=this.events)==null?void 0:n.get(e))==null?void 0:r.callback)==null||c.call(r,i)}onError(t){console.error(t)}remove(t){this.events.delete(t)}dispose(){this.events.clear()}};class xt{downloadImage(t,e="image"){const i=document.createElement("a");i.href=URL.createObjectURL(new Blob([t],{type:"text/plain; charset=UTF-8"})),i.download=`${e}.ppm`,i.click(),URL.revokeObjectURL(i.href)}}const Et=`#version 300 es

precision mediump float;

uniform vec2 resolution;

in  vec2 position;
in  vec2 coords;
out vec2 uv;

void main (void)
{
  gl_Position = vec4((
    position / resolution * 2.0 - 1.0
  ) * vec2(1.0, -1.0), 0.0, 1.0);

  uv = coords;
}
`,bt=`#version 300 es

#ifndef GL_FRAGMENT_PRECISION_HIGH
  precision mediump float;
#else
  precision highp float;
#endif

uniform sampler2D tex;

in  vec2 uv;
out vec4 fragColor;

void main (void)
{
  fragColor = texture(tex, uv);
}
`,_=(s,t=0,e=1)=>Math.max(t,Math.min(s,e)),yt=(s,t=2)=>{const e=Math.pow(10,t);return~~(e*s)/e},St=({r:s,g:t,b:e})=>_(s*255,0,255)<<16^_(t*255,0,255)<<8^_(e*255,0,255)<<0,Tt=(s,t=1)=>(s=typeof s=="string"?Pt(s):s,{r:s>>16&t,g:s>>8&t,b:s&t}),j=s=>(s=typeof s=="number"?s:St(s),`#${`000000${s.toString(16)}`.slice(-6)}`),Pt=s=>(s=typeof s=="string"?s:j(s),parseInt(s.slice(1),16)),At=s=>s.set(255.999*s.x|0,255.999*s.y|0,255.999*s.z|0);class H{constructor(t,e){h(this,"context");h(this,"backEnd");h(this,"clearColor",0);h(this,"channels");h(this,"height");h(this,"width");h(this,"side");this.backEnd=e;const i=e==="2d",{canvas:n,offscreen:r}=t;this.context=n.getContext(e,this.getOptions(e,r)),this.width=n.width,this.height=n.height,this.channels=+i+3,this.side=this.width*this.channels}getOptions(t,e=!1){switch(t){case"2d":return{willReadFrequently:!e,desynchronized:e,colorSpace:"srgb",alpha:!1};case"webgpu":return{};default:return{powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!1,premultipliedAlpha:!1,desynchronized:!0,antialias:!0,stencil:!1,depth:!1,alpha:!1}}}getPixel(t,e){return e*this.side+t*this.channels}}const Rt=`precision mediump float;

uniform vec2 resolution;

attribute vec2 position;
attribute vec2 coords;
varying   vec2 uv;

void main (void)
{
  gl_Position = vec4((
    position / resolution * 2.0 - 1.0
  ) * vec2(1.0, -1.0), 0.0, 1.0);

  uv = coords;
}
`,Ct=`#ifndef GL_FRAGMENT_PRECISION_HIGH
  precision mediump float;
#else
  precision highp float;
#endif

uniform sampler2D tex;

varying vec2 uv;

void main (void)
{
  gl_FragColor = texture2D(tex, uv);
}
`;class q extends H{constructor(e,i="webgl",n=Ct,r=Rt){super(e,i);h(this,"textureData",new Uint8ClampedArray(this.width*this.height*this.channels));h(this,"texture");h(this,"program");this.createProgram(n,r),this.createScene()}loadShader(e,i){const n=this.context.createShader(i);return this.context.shaderSource(n,e),this.context.compileShader(n),this.context.getShaderParameter(n,this.context.COMPILE_STATUS)?n:(console.error(`An error occurred compiling the shaders: ${this.context.getShaderInfoLog(n)}`),this.context.deleteShader(n))}setBufferData(e=this.width,i=this.height){this.context.bufferData(this.context.ARRAY_BUFFER,new Float32Array([0,0,e,0,0,i,0,i,e,0,e,i]),this.context.STATIC_DRAW)}createProgram(e,i){const n=this.loadShader(e,this.context.FRAGMENT_SHADER),r=this.loadShader(i,this.context.VERTEX_SHADER);if(this.program=this.context.createProgram(),r&&n&&(this.context.attachShader(this.program,n),this.context.attachShader(this.program,r),this.context.linkProgram(this.program)),!this.context.getProgramParameter(this.program,this.context.LINK_STATUS))return console.error(`Unable to initialize shader program: ${this.context.getProgramInfoLog(this.program)}`);this.context.clear(this.context.COLOR_BUFFER_BIT);const{r:c,g:o,b:a}=Tt(this.clearColor,1);this.context.clearColor(c,o,a,1),this.context.useProgram(this.program)}updateTexture(){this.context.activeTexture(this.context.TEXTURE0),this.context.bindTexture(this.context.TEXTURE_2D,this.texture),this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGB,this.width,this.height,0,this.context.RGB,this.context.UNSIGNED_BYTE,this.textureData)}createScene(){const e=this.context.getAttribLocation(this.program,"coords");this.context.bindBuffer(this.context.ARRAY_BUFFER,this.context.createBuffer()),this.setBufferData(1,1),this.context.enableVertexAttribArray(e),this.context.vertexAttribPointer(e,2,this.context.FLOAT,!1,0,0);const i=this.context.getAttribLocation(this.program,"position");this.context.bindBuffer(this.context.ARRAY_BUFFER,this.context.createBuffer()),this.setBufferData(),this.context.enableVertexAttribArray(i),this.context.vertexAttribPointer(i,2,this.context.FLOAT,!1,0,0);const n=this.context.getUniformLocation(this.program,"resolution");this.context.uniform2f(n,this.width,this.height),this.texture=this.context.createTexture(),this.setBufferData(),this.updateTexture(),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.NEAREST),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MAG_FILTER,this.context.NEAREST)}drawImage(e){this.textureData=e,this.updateTexture(),this.context.drawArrays(this.context.TRIANGLES,0,6)}clear(){this.context.clear(this.context.COLOR_BUFFER_BIT)}}class It extends q{constructor(t){super(t,"webgl2",bt,Et)}}class kt extends H{constructor(e){super(e,"2d");h(this,"image");this.context.imageSmoothingEnabled=!0,this.context.imageSmoothingQuality="high",this.image=this.context.getImageData(0,0,this.width,this.height)}drawImage(e){for(let i=0,n=0;i<e.length;i+=3,n+=4)this.image.data[n+0]=e[i+0],this.image.data[n+1]=e[i+1],this.image.data[n+2]=e[i+2],this.image.data[n+3]=255;this.context.putImageData(this.image,0,0)}clear(){this.context.fillStyle=j(this.clearColor),this.context.clearRect(0,0,this.width,this.height),this.context.fillRect(0,0,this.width,this.height)}}class d{constructor(t=0,e,i){h(this,"vec",[0,0,0]);this.vec[0]=t,this.vec[1]=e??t,this.vec[2]=i??t}multiply(t){if(typeof t!="number")return this.set(this.vec[0]*t.x,this.vec[1]*t.y,this.vec[2]*t.z);const e=t;return this.vec[0]*=e,this.vec[1]*=e,this.vec[2]*=e,this}divide(t){return typeof t=="number"?this.multiply(1/t):this.set(this.vec[0]/t.x,this.vec[1]/t.y,this.vec[2]/t.z)}get(t){return t===void 0?this.vec:this.vec[t]}set(t,e,i){return this.vec[0]=t,this.vec[1]=e,this.vec[2]=i,this}get lengthSquared(){return this.dot(this)}cross(t){return this.set(this.vec[1]*t.z-this.vec[2]*t.y,this.vec[2]*t.x-this.vec[0]*t.z,this.vec[0]*t.y-this.vec[1]*t.x)}dot(t){return this.vec[0]*t.x+this.vec[1]*t.y+this.vec[2]*t.z}copy(t){const{x:e,y:i,z:n}=t;return this.set(e,i,n)}add(t){return this.vec[0]+=t.x,this.vec[1]+=t.y,this.vec[2]+=t.z,this}sub(t){return this.vec[0]-=t.x,this.vec[1]-=t.y,this.vec[2]-=t.z,this}get unitVector(){return this.divide(this.length)}get length(){return Math.sqrt(this.lengthSquared)}get clone(){return new d(...this.get())}reset(t=0){return this.set(t,t,t)}get x(){return this.vec[0]}get y(){return this.vec[1]}get z(){return this.vec[2]}print(){const[t,e,i]=this.vec;return`Vector3 { x: ${t}, y: ${e}, z: ${i} }`}negate(){return this.vec[0]*=-1,this.vec[1]*=-1,this.vec[2]*=-1,this}}class Lt{constructor(){h(this,"t",0);h(this,"frontFace",!1);h(this,"point",new d);h(this,"normal",new d)}copy(t){this.frontFace=t.frontFace,this.normal.copy(t.normal),this.point.copy(t.point),this.t=t.t}setFaceNormal(t,e){this.frontFace=t.direction.clone.dot(e)<0,this.normal.copy(this.frontFace?e:e.negate())}}const S=new Lt;class Y{}class Mt extends Y{constructor(e){super();h(this,"objects",[]);e&&this.add(e)}add(e){this.objects.push(e)}hit(e,i,n,r){let c=!1,o=n;for(let a=0,l=this.objects.length;a<l;a++)this.objects[a].hit(e,i,o,S)&&(o=S.t,r.copy(S),c=!0);return c}clear(){this.objects.length=0}}class _t{constructor(){h(this,"hittables",new Mt);this.addSphere(new d(0,0,-1),.5),this.addSphere(new d(0,-100.5,-1),100)}addSphere(t,e){this.hittables.add(new Dt(t,e))}get objects(){return this.hittables}}class Dt extends Y{constructor(t=new d,e=0){super(),this.center=t,this.radius=e}hit(t,e,i,n){const r=t.origin.clone.sub(this.center),c=t.direction.lengthSquared,o=r.dot(t.direction),a=r.lengthSquared-this.radius*this.radius,l=o*o-c*a;if(l<0)return!1;const f=Math.sqrt(l);let u=(-o-f)/c;if((u<e||u>i)&&(u=(-o+f)/c,u<e||u>i))return!1;n.t=u,n.point.copy(t.at(n.t));const x=n.point.clone.sub(this.center).divide(this.radius);return n.setFaceNormal(t,x),!0}}class Ut{constructor(){h(this,"width",w.Scene.width);h(this,"height",w.Scene.height);h(this,"ratio",this.width/this.height);h(this,"callbacks",[])}addResizeCallback(t){this.callbacks.indexOf(t)===-1&&this.callbacks.push(t)}removeResizeCallback(t){const e=this.callbacks.indexOf(t);e!==-1&&this.callbacks.splice(e,1)}update(t=w.Scene.width,e=w.Scene.height){this.width=t,this.height=e,this.ratio=this.width/this.height;for(let i=this.callbacks.length;i--;)this.callbacks[i](this.width,this.height,this.ratio)}dispose(){this.callbacks.length=0}get size(){return{height:this.height,width:this.width,ratio:this.ratio}}}const Ft=new Ut;class $t{constructor(){h(this,"height",2);h(this,"focalLength",1);h(this,"origin",new d);h(this,"width",Ft.size.ratio*this.height);h(this,"vertical",new d(0,this.height,0));h(this,"horizontal",new d(this.width,0,0));h(this,"lowerLeftCorner",this.origin.clone.sub(this.horizontal.clone.divide(2)).sub(this.vertical.clone.divide(2)).sub(new d(0,0,this.focalLength)))}getDirection(t,e){return this.lowerLeftCorner.clone.add(this.horizontal.clone.multiply(t)).add(this.vertical.clone.multiply(e)).sub(this.origin)}}class Ot{constructor(t,e){h(this,"color",new d(1));this.orig=t,this.dir=e}at(t){return this.orig.clone.add(this.dir.multiply(t))}getColor(t,e){if(e.hit(t,0,1/0,S))return new d(1).add(S.normal).multiply(.5);const i=(t.dir.unitVector.y+1)*.5;return this.color.reset(1).multiply(1-i).add(new d(.5,.7,1).multiply(i))}get direction(){return this.dir}get origin(){return this.orig}}class K{constructor(){h(this,"world",new _t);h(this,"color",new d);h(this,"camera",new $t);h(this,"width",w.Scene.width);h(this,"height",w.Scene.height)}createPPMImage(){const t=new Uint8ClampedArray(this.width*this.height*3);for(let e=0,i=this.height-1,n=this.width-1,r=i;i>-1;i--){console.info(`Progress: ${yt((1-i/r)*100)}%`);for(let c=0;c<this.width;c++,e+=3){const o=c/n,a=i/r,l=new Ot(this.camera.origin,this.camera.getDirection(o,a));this.color.set(...l.getColor(l,this.world.objects).get());const{x:f,y:u,z:x}=At(this.color);t[e+0]=f,t[e+1]=u,t[e+2]=x}}return t}}class Q{constructor(t){h(this,"canvas");h(this,"tracer");h(this,"worker");this.canvas=this.createCanvas(t),(this.worker=t.worker)?this.createWorkerEvents():this.tracer=new K,this.canvas.clear(),this.createPPMImage()}createCanvas(t){switch(t.backEnd){case"webgl2":return new It(t);case"webgl":return new q(t);default:return new kt(t)}}createWorkerEvents(){var t;(t=this.worker)==null||t.add("Create::PPMImage",this.showPPMImage.bind(this))}createPPMImage(t=!1){var e;this.worker?this.worker.post("Create::PPMImage",{download:t}):this.showPPMImage({download:t,pixels:(e=this.tracer)==null?void 0:e.createPPMImage()},!0)}showPPMImage(t,e){const{download:i,pixels:n}=t;i&&this.downloadPPMImage(n,e),this.canvas.drawImage(n)}downloadPPMImage(t,e){let i=`P3
${this.canvas.width} ${this.canvas.height}
255
`;for(let n=0;n<t.length;n+=3)i+=`${t[n]} ${t[n+1]} ${t[n+2]}
`;F.dispatch("Download::PPMImage",{image:i},e)}}self.onerror=s=>console.error(s);self.onmessage=s=>{const{event:t}=s.data;let{params:e}=s.data;const i=new K;switch(t){case"Transfer::Offscreen":return new Q({offscreen:!0,...e});case"Create::PPMImage":{const n=i.createPPMImage();e={...e,pixels:n};break}}self.postMessage({response:e,name:t})};const Bt=self;class Nt extends CustomEvent{constructor(){super(...arguments);h(this,"data")}}class zt{constructor(){h(this,"target",new EventTarget);h(this,"events",new Map);h(this,"callbacks",new Map)}add(t,e){const i=this.callbacks.get(t);i?i.push(e):this.callbacks.set(t,[e]),this.events.set(t,new Nt(t)),this.target.addEventListener(t,e,!1)}dispatch(t,e){const i=this.events.get(t);i&&(i.data=e,this.target.dispatchEvent(i))}remove(t,e){const i=this.callbacks.get(t);if(i&&e){const n=i.indexOf(e),r=e;n!==-1&&i.splice(n,1),this.target.removeEventListener(t,r,!1)}e||(i==null||i.forEach(n=>this.target.removeEventListener(t,n,!1)),this.callbacks.delete(t),this.events.delete(t))}dispose(){this.callbacks.clear(),this.events.clear()}}class z{constructor(t){this.worker=t}add(t,e){this.worker.add(t,e)}static dispatch(t,e){Bt.postMessage({name:t,response:{data:e}})}remove(t){this.worker.remove(t)}dispose(){this.worker.dispose()}}class Wt extends zt{constructor(){super(...arguments);h(this,"offscreen",!1);h(this,"workerEvents")}createWorkerEvents(e,i){this.workerEvents=new z(e),this.offscreen=i}add(e,i){var n;this.offscreen?(n=this.workerEvents)==null||n.add(e,i):super.add(e,i)}dispatch(e,i,n=!1){n?z.dispatch(e,i):super.dispatch(e,i)}remove(e,i){var n;this.offscreen?(n=this.workerEvents)==null||n.remove(e):super.remove(e,i)}dispose(){var e;(e=this.workerEvents)==null||e.dispose(),super.dispose()}}const F=new Wt;class Gt{constructor(t){h(this,"client",new xt);h(this,"worker",new vt);h(this,"offscreen",typeof HTMLCanvasElement<"u"&&!!HTMLCanvasElement.prototype.transferControlToOffscreen);F.createWorkerEvents(this.worker,this.offscreen);const{backEnd:e,pixelRatio:i=devicePixelRatio}=w.Scene;F.add("Download::PPMImage",this.downloadPPMImage.bind(this)),this.offscreen?this.worker.transfer(t.transferControlToOffscreen(),{backEnd:e,pixelRatio:i}):new Q({canvas:t,worker:this.worker,backEnd:e,pixelRatio:i})}downloadPPMImage(t){const{image:e}=t.data;this.client.downloadImage(e)}}const Vt=gt("<canvas>"),Xt=()=>{let s;return rt(()=>new Gt(s)),(()=>{const t=Vt(),e=s;return typeof e=="function"?pt(e,t):s=t,P(i=>{const n=w.Scene.height,r=w.Scene.width;return n!==i._v$&&B(t,"height",i._v$=n),r!==i._v$2&&B(t,"width",i._v$2=r),i},{_v$:void 0,_v$2:void 0}),t})()};dt(()=>ut(Xt,{}),document.getElementById("root"));
